---
title: React æ•™ç¨‹ä¹‹ä»æ¦‚å¿µåˆ°å®æˆ˜
date: 2020-07-12 16:54
updated: 2020-07-12 16:54
cover: //cdn.wallleap.cn/img/pic/cover/202302ihq49n.jpg
category: æŠ€æœ¯æ‚è°ˆ
tags:
  - web
  - å‰ç«¯
description: React æ•™ç¨‹ä¹‹ä»æ¦‚å¿µåˆ°å®æˆ˜
---

å‰ç«¯ä¸‰å¤§æ¡†æ¶ä¹‹ä¸€ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“

## ä¸€ã€React å…¥é—¨

### 1.1 React çš„åŸºæœ¬è®¤è¯†

React å®˜ç½‘ï¼š

- è‹±æ–‡å®˜ç½‘ï¼š<https://reactjs.org/>

- ä¸­æ–‡å®˜ç½‘ï¼š<https://doc.react-china.org/>

ä»‹ç»æè¿°ï¼š

React æ˜¯ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript æ¡†æ¶ï¼ˆåªå…³æ³¨äº Viewï¼‰

- JS åº“&æ¡†æ¶ï¼š
  
  - jQueryâ€”â€”å‡½æ•°åº“ï¼ˆæ–¹æ³•ã€å‡½æ•°åŒ…è£… DOM æ“ä½œï¼‰
  
  - React åŸºæœ¬ä¸Šä¸æ“ä½œ DOMâ€”â€”JS æ¡†æ¶

- æ„å»ºç”¨æˆ·ç•Œé¢ï¼šæŠŠæ•°æ®å±•ç°å‡ºæ¥

- ç”±**Facebook**å¼€æº

React çš„ç‰¹ç‚¹ï¼š

- Declarativeï¼ˆå£°æ˜å¼ç¼–ç ï¼‰
  - ä¸éœ€è¦äº²è‡ªæ“ä½œ DOMï¼ˆç”³è¯·ä¸€å—å†…å­˜ï¼Œåªéœ€è¦å£°æ˜ä¸€ä¸ªå˜é‡å³å¯ï¼‰ï¼Œåªéœ€è¦å‘Šè¯‰å®ƒï¼Œæˆ‘è¦æ›´æ–°ï¼Œå°±ä¼šå¸®ä½ æ›´æ–°ï¼Œåªéœ€è¦æ›´æ–°æ•°æ®ï¼Œç•Œé¢ä¸éœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼ˆä»¥å‰éœ€è¦æ›´æ–° DOMï¼‰

- Component-Basedï¼ˆç»„ä»¶åŒ–ç¼–ç ï¼‰
  - ç®€åŒ–ç‰¹åˆ«å¤æ‚çš„åŠŸèƒ½ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªç®€å•çš„éƒ¨åˆ†ï¼ˆä¸€ä¸ªå°çš„ç•Œé¢åŠŸèƒ½å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼‰ï¼Œç»´æŠ¤ä¹Ÿæ–¹ä¾¿

- Learn Once, Write Anywhereï¼ˆæ”¯æŒå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ¸²æŸ“ï¼‰
  - ä¸€æ¬¡å­¦ä¹ ï¼Œéšå¤„ç¼–å†™ï¼šä¸ä»…èƒ½å†™ web åº”ç”¨ï¼Œè¿˜èƒ½é€šè¿‡ React Native æ‰“åŒ…ä¸º Androidã€IOS åº”ç”¨

- é«˜æ•ˆ

- å•å‘æ•°æ®æµ

React é«˜æ•ˆçš„åŸå› ï¼ˆåŒºåŸŸã€æ¬¡æ•°â€”â€”æ›´æ–°ç•Œé¢æ•ˆç‡æé«˜ï¼‰ï¼š

- **è™šæ‹Ÿï¼ˆvirtualï¼‰DOM**ï¼Œä¸æ€»æ˜¯ç›´æ¥æ“ä½œ DOM
  - è™šæ‹Ÿ DOMï¼šå¯¹è±¡â€”â€”ä¸ç»„ä»¶å¯¹åº”ï¼Œä¿®æ”¹æ˜ å°„åˆ°çœŸå®çš„ DOM ä¸Šï¼ˆæ‰¹é‡ä¿®æ”¹ã€ç•Œé¢é‡ç»˜**æ¬¡æ•°å°‘**ï¼‰

- **DOM Diff ç®—æ³•**ï¼Œæœ€å°åŒ–é¡µé¢é‡ç»˜
  - ç•Œé¢ä¸­ç»„ä»¶æ˜¯å¦æ›´æ–°ï¼ˆæ›´æ–°**åŒºåŸŸå°**ï¼‰

### 1.2 React çš„åŸºæœ¬ä½¿ç”¨

æ³¨æ„ï¼š*æ­¤æ—¶åªæ˜¯æµ‹è¯•è¯­æ³•ä½¿ç”¨, å¹¶ä¸æ˜¯çœŸå®é¡¹ç›®å¼€å‘ä½¿ç”¨*

å®ç°æ•ˆæœï¼šå°† h1 æ ‡ç­¾åˆ©ç”¨ react æ”¾åˆ° test ä¸­

![ReactåŸºæœ¬ä½¿ç”¨](https://cdn.wallleap.cn/img/pic/illustration/react1592556203130.png)

ç›¸å…³çš„åº“ï¼š

- `react.js`ï¼šReact çš„æ ¸å¿ƒåº“
  - development.jsï¼šå¼€å‘ç‰ˆï¼Œå¼€å‘ç¼–å†™çš„æ—¶å€™ä½¿ç”¨
  - production.min.jsï¼šç”Ÿäº§ç‰ˆï¼Œä¸Šçº¿çš„æ—¶å€™ä½¿ç”¨ï¼Œå‹ç¼©è¿‡çš„

- `react-dom.js`ï¼šæä¾›æ“ä½œ DOM çš„ React æ‰©å±•åº“

- `babel.min.js`ï¼šè§£æ JSX è¯­æ³•ä»£ç è½¬ä¸ºçº¯ JS è¯­æ³•ä»£ç çš„åº“ï¼Œè¿™é‡Œä¸æ˜¯ ES6 è½¬ ES5ï¼ˆjsx æ˜¯ js æ‰©å±•è¯­æ³•ï¼‰

å¯ä»¥åˆ° bootcdn å¼•ç”¨åœ°å€ï¼Œè®¿é—®é“¾æ¥ <kbd>Ctrl</kbd> + <kbd>S</kbd> ä¿å­˜åˆ°æœ¬åœ°

åœ¨é¡µé¢ä¸­å¯¼å…¥ js

```html
<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
```

å¼€å§‹ç¼–ç 

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>01_HelloWorld</title>
</head>
<body>
  <div id="test"></div>

  <script type="text/javascript" src="../js/react.development.js"></script>
  <script type="text/javascript" src="../js/react-dom.development.js"></script>
  <script type="text/javascript" src="../js/babel.min.js"></script>
  <script type="text/babel">/*å‘Šè¯‰babel.jsè§£æé‡Œé¢çš„jsxçš„ä»£ç */
    // 1. åˆ›å»ºè™šæ‹ŸDOMå…ƒç´ å¯¹è±¡
    var vDom = <h1>Hello React!</h1>   // jsxï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èƒ½åŠ å¼•å·
    // 2. å°†è™šæ‹ŸDOMæ¸²æŸ“åˆ°é¡µé¢çœŸå®DOMå®¹å™¨ä¸­
    ReactDOM.render(vDom, document.getElementById('test'))  // react-dom.jsæä¾›çš„  renderâ€”â€”æ¸²æŸ“   å°†vDomåŠ å…¥åˆ°#testä¸­
  </script>
</body>
</html>
```

ä½¿ç”¨ React å¼€å‘è€…å·¥å…·è°ƒè¯•

[React Developer Tool](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=zh-CN)

### 1.3 React JSX

å®ç°æ•ˆæœï¼šä¸¤ä¸ª `#test` åˆ†åˆ«åŠ å…¥ç›¸åº”å†…å®¹

![React JSX](https://cdn.wallleap.cn/img/pic/illustration/react1592556978982.png)

ä»£ç ï¼š

```html
<div id="test1"></div>
<div id="test2"></div>

<script src="../js/react.development.js"></script>
<script src="../js/react-dom.development.js"></script>
<script src="../js/babel.min.js"></script>

<script> // è¿˜æ²¡ç”¨åˆ°jsxè¯­æ³•ï¼Œä¸éœ€è¦babel
  const msg = 'I Like You!'
  const myId = 'Atguigu'

  // 1.åˆ›å»ºè™šæ‹ŸDOM
  // var element = React.createElement('h1', {id:'myTitle'},'hello')
  const vDom1 = React.createElement('h2', {id:myId.toLowerCase()},msg.toUpperCase())
  // 2.æ¸²æŸ“è™šæ‹ŸDOM
  ReactDOM.render(vDom1, document.getElementById('test1'))
</script>

<script type="text/babel">
  // 1.åˆ›å»ºè™šæ‹ŸDOM
  const vDom2 = <h3 id={myId.toUpperCase()}>{msg.toLowerCase()}</h3>  // å˜é‡ç”¨{}æ‹¬èµ·æ¥
  // 2.æ¸²æŸ“è™šæ‹ŸDOM
  ReactDOM.render(vDom2, document.getElementById('test2'))
</script>
```

è™šæ‹Ÿ DOM

- React æä¾›äº†ä¸€äº› API æ¥åˆ›å»ºä¸€ç§ **ç‰¹åˆ«** çš„ä¸€èˆ¬ js å¯¹è±¡
  - `var element = React.createElement('h1', {id:'myTitle'}, 'hello')`
  - ä¸Šé¢åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿ DOM å¯¹è±¡ï¼Œbabel å°†ä¼šæŠŠ jsx è¯­æ³•è½¬ä¸ºä¸Šè¿°çš„å½¢å¼

- è™šæ‹Ÿ DOM å¯¹è±¡æœ€ç»ˆéƒ½ä¼šè¢« React **è½¬æ¢ä¸º**çœŸå®çš„ DOMï¼ˆè™šæ‹Ÿ DOM ä¸­çš„å¯¹åº”çœŸå® DOM ä¸­çš„æ ‡ç­¾å…ƒç´ ï¼‰

- æˆ‘ä»¬ç¼–ç æ—¶åŸºæœ¬åªéœ€è¦æ“ä½œ react çš„è™šæ‹Ÿ DOM ç›¸å…³æ•°æ®ï¼Œreact ä¼šè½¬æ¢ä¸ºçœŸå® DOM å˜åŒ–è€Œæ›´æ–°ç•Œé¢

è¡¥å……çŸ¥è¯†ï¼š`debugger` å¯ä»¥åœ¨æŸæ¡ js ä»£ç å¤„æ·»åŠ æ–­ç‚¹

è™šæ‹Ÿ DOMâ€”â€”è½»å¯¹è±¡ï¼Œæ›´æ–°è™šæ‹Ÿ DOM é¡µé¢ä¸é‡ç»˜

çœŸå® DOMâ€”â€”é‡å¯¹è±¡ï¼Œæ›´æ–°çœŸå® DOM é¡µé¢ä¼šå‘ç”Ÿå˜åŒ–ï¼ˆé¡µé¢é‡ç»˜ï¼‰

JSX

- å…¨ç§°ï¼šJavaScript XML
- react å®šä¹‰çš„ä¸€ç§ç±»ä¼¼äº XML çš„**JS æ‰©å±•è¯­æ³•**ï¼šXML+JS
- ä½œç”¨ï¼šç”¨æ¥åˆ›å»º react è™šæ‹Ÿ DOM(å…ƒç´ )å¯¹è±¡
- ä¾‹å¦‚ï¼š`var ele = <h1>Hello JSX!</h1>`
- æ³¨æ„1ï¼šå®ƒä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸æ˜¯ HTML/XML æ ‡ç­¾
- æ³¨æ„2ï¼šå®ƒæœ€ç»ˆäº§ç”Ÿçš„å°±æ˜¯ä¸€ä¸ª JS å¯¹è±¡
- **æ ‡ç­¾åä»»æ„**ï¼šHTML æ ‡ç­¾æˆ–å…¶å®ƒæ ‡ç­¾
- æ ‡ç­¾å±æ€§ä»»æ„ï¼šHTML æ ‡ç­¾å±æ€§æˆ–å…¶å®ƒ
- åŸºæœ¬è¯­æ³•è§„åˆ™
  - **é‡åˆ° `<` å¼€å¤´**çš„ä»£ç , ä»¥**æ ‡ç­¾**çš„è¯­æ³•è§£æï¼šhtml åŒåæ ‡ç­¾è½¬æ¢ä¸º html åŒåå…ƒç´ ï¼Œå…¶å®ƒæ ‡ç­¾éœ€è¦ç‰¹åˆ«è§£æ
  - **é‡åˆ°ä»¥ `{` å¼€å¤´**çš„ä»£ç ï¼Œä»¥ **JS è¯­æ³•**è§£æï¼šæ ‡ç­¾ä¸­çš„ js ä»£ç å¿…é¡»ç”¨ `{}` åŒ…å«

babel.js çš„ä½œç”¨

- æµè§ˆå™¨ä¸èƒ½ç›´æ¥è§£æ JSX ä»£ç ï¼Œéœ€è¦ **babel è½¬è¯‘ä¸ºçº¯ JS çš„ä»£ç **æ‰èƒ½è¿è¡Œ
- åªè¦ç”¨äº† JSXï¼Œéƒ½è¦åŠ ä¸Š `type="text/babel"`ï¼Œå£°æ˜éœ€è¦ babel æ¥å¤„ç†

æ¸²æŸ“è™šæ‹Ÿ DOMï¼ˆå…ƒç´ ï¼‰

- è¯­æ³•ï¼š`ReactDOM.render(virtualDOM, containerDOM)`
- ä½œç”¨ï¼šå°†è™šæ‹Ÿ DOM å…ƒç´ æ¸²æŸ“åˆ°é¡µé¢ä¸­çš„çœŸå®å®¹å™¨ DOM ä¸­æ˜¾ç¤º
- å‚æ•°è¯´æ˜
  - å‚æ•°ä¸€ï¼šçº¯ js æˆ– jsx åˆ›å»ºçš„è™šæ‹Ÿ dom å¯¹è±¡
  - å‚æ•°äºŒï¼šç”¨æ¥åŒ…å«è™šæ‹Ÿ DOM å…ƒç´ çš„çœŸå® dom å…ƒç´ å¯¹è±¡(ä¸€èˆ¬æ˜¯ä¸€ä¸ª div)

å»ºè™šæ‹Ÿ DOM çš„ 2 ç§æ–¹å¼

- çº¯ JSï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰ `React.createElement('h1', {id:'myTitle'}, title)`
- **JSX**: `<h1 id='myTitle'>{title}</h1>`

JSX ç»ƒä¹ ï¼šåŠ¨æ€å±•ç¤ºåˆ—è¡¨æ•°æ®

![JSX](https://cdn.wallleap.cn/img/pic/illustration/react1592558986188.png)

ä»£ç ï¼š

```html
<h2>å‰ç«¯JSæ¡†æ¶åˆ—è¡¨</h2>
<div id="example1"></div>
<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
    åŠŸèƒ½: åŠ¨æ€å±•ç¤ºåˆ—è¡¨æ•°æ®
    - å¦‚ä½•å°†ä¸€ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæ ‡ç­¾çš„æ•°ç»„
      ä½¿ç”¨æ•°ç»„çš„map()æ–¹æ³•
  */
  // æ•°æ®ï¼šåç§°ã€ç±»å‹ï¼Œæ•°ç»„å­˜æ”¾
  const names = ['jQuery', 'zepto', 'angular', 'react', 'vue']
  // 1.åˆ›å»ºè™šæ‹ŸDOMï¼Œæœ‰åµŒå¥—ç»“æ„ï¼Œæœ€å¥½ç”¨å°æ‹¬å·æ‹¬èµ·æ¥
  const ul = (
    <ul>
      {
        names.map((name, index) => <li key={index}>{name}</li>)
      }
    </ul>
  )
  // 2.æ¸²æŸ“è™šæ‹ŸDOM
  ReactDOM.render(ul, document.getElementById('example1'))
</script>
```

### 1.4 æ¨¡å—ä¸ç»„ä»¶å’Œæ¨¡å—åŒ–ä¸ç»„ä»¶åŒ–çš„ç†è§£

æ¨¡å—

- ç†è§£ï¼šå‘å¤–**æä¾›ç‰¹å®šåŠŸèƒ½çš„** js ç¨‹åºï¼Œä¸€èˆ¬å°±æ˜¯ä¸€ä¸ª **js æ–‡ä»¶**
- ä¸ºä»€ä¹ˆï¼šjs ä»£ç æ›´å¤šæ›´å¤æ‚
- ä½œç”¨ï¼šå¤ç”¨ jsï¼Œç®€åŒ– js çš„ç¼–å†™ï¼Œæé«˜ js è¿è¡Œæ•ˆç‡

æœ‰ç‰¹å®šåŠŸèƒ½çš„ js æ–‡ä»¶ï¼Œå†…éƒ¨æœ‰æ•°æ®åŠå¯¹æ•°æ®çš„æ“ä½œ

- æ•°æ®ï¼šå˜é‡
- æ“ä½œï¼šå‡½æ•°

ç§æœ‰çš„å‡½æ•°å‘å¤–æš´éœ²

- æš´éœ²ä¸€ä¸ªå‡½æ•°ï¼šæš´éœ²å‡½æ•°æœ¬èº«
- æš´éœ²å¤šä¸ªå‡½æ•°ï¼šä»¥å¯¹è±¡å½¢å¼æš´éœ²

ç»„ä»¶

- ç†è§£ï¼šç”¨æ¥**å®ç°ç‰¹å®šï¼ˆå±€éƒ¨ï¼‰åŠŸèƒ½æ•ˆæœ**çš„**ä»£ç **é›†åˆï¼ˆhtml/css/jsï¼‰
- ä¸ºä»€ä¹ˆï¼šä¸€ä¸ªç•Œé¢çš„åŠŸèƒ½æ›´å¤æ‚
- ä½œç”¨ï¼šå¤ç”¨ç¼–ç ï¼Œç®€åŒ–é¡¹ç›®ç¼–ç ï¼Œæé«˜è¿è¡Œæ•ˆç‡

æ¨¡å—åŒ–

- å½“åº”ç”¨çš„ **js éƒ½ä»¥æ¨¡å—æ¥ç¼–å†™**çš„ï¼Œè¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„åº”ç”¨
- å½¢å®¹é¡¹ç›®æˆ–ç¼–ç 

ç»„ä»¶åŒ–

- å½“åº”ç”¨æ˜¯ä»¥å¤šç»„ä»¶çš„æ–¹å¼å®ç°ï¼Œè¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–çš„åº”ç”¨

ä¾‹å¦‚ä¸‹é¢ App ç»„ä»¶å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒåˆæ˜¯ç”±å¤šä¸ªç»„ä»¶ç»„æˆçš„

- CommentAdd ç»„ä»¶
- CommentList ç»„ä»¶
  - å¤šä¸ª CommentItem ç»„ä»¶

![component](https://cdn.wallleap.cn/img/pic/illustration/react1592560823655.png)

## äºŒã€React é¢å‘ç»„ä»¶ç¼–ç¨‹

é¢å‘å¯¹è±¡ â†’ é¢å‘æ¨¡å— â†’ é¢å‘ç»„ä»¶

### 2.1 åŸºæœ¬ç†è§£å’Œä½¿ç”¨

å®ç°æ•ˆæœ

![ç»„ä»¶](https://cdn.wallleap.cn/img/pic/illustration/react1592561100045.png)

ç»„ä»¶æ ‡ç­¾ï¼šå¯ä»¥éšä¾¿å–çš„æ ‡ç­¾ï¼Œé¦–å­—æ¯å¤§å†™ï¼ˆä¸ HTML æ ‡ç­¾åŒºåˆ†å¼€ï¼‰

è‡ªå®šä¹‰ç»„ä»¶ï¼ˆComponentï¼‰ï¼š

1. å®šä¹‰ç»„ä»¶ï¼ˆ2 ç§æ–¹å¼ï¼‰

   - æ–¹å¼ 1ï¼š**å·¥å‚å‡½æ•°ç»„ä»¶ï¼ˆç®€å•ç»„ä»¶ï¼šæ²¡æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼‰**â€”â€”æ•ˆç‡é«˜ï¼Œä¸éœ€è¦åˆ›å»ºå¯¹è±¡

      ```js
      function MyComponent() {
        return <h2>å·¥å‚å‡½æ•°ç»„ä»¶ï¼ˆç®€å•ç»„ä»¶ï¼‰</h2>
      }
      ```

   - æ–¹å¼ 2ï¼š**ES6 ç±»ç»„ä»¶ï¼ˆå¤æ‚ç»„ä»¶ï¼‰**â€”â€”éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæœ‰äº†çŠ¶æ€åªèƒ½ä½¿ç”¨è¿™ç§æ–¹å¼

      ```javascript
      class MyComponent2 extends React.Component {
        render() {
          console.log(this)  // ç»„ä»¶ç±»å¯¹è±¡ MyComponent2{...}
          return <h2>ES6ç±»ç»„ä»¶ï¼ˆå¤æ‚ç»„ä»¶ï¼‰</h2>
        }
      }
      ```

2. æ¸²æŸ“ç»„ä»¶æ ‡ç­¾

    ```JavaScript
    ReactDOM.render(<MyComponent  />, document.getElementById('example1'))
    ReactDOM.render(<MyComponent2  />, document.getElementById('example2'))
    ```

æ³¨æ„

- ç»„ä»¶åå¿…é¡»**é¦–å­—æ¯å¤§å†™**
- è™šæ‹Ÿ DOM å…ƒç´ åªèƒ½æœ‰**ä¸€ä¸ªæ ¹å…ƒç´ **
- è™šæ‹Ÿ DOM å…ƒç´ å¿…é¡»**æœ‰ç»“æŸæ ‡ç­¾**

`render()` æ¸²æŸ“ç»„ä»¶æ ‡ç­¾çš„åŸºæœ¬æµç¨‹

1. React å†…éƒ¨ä¼šåˆ›å»ºç»„ä»¶å®ä¾‹å¯¹è±¡
2. å¾—åˆ°åŒ…å«çš„è™šæ‹Ÿ DOM å¹¶è§£æä¸ºçœŸå® DOM
3. æ’å…¥åˆ°æŒ‡å®šçš„é¡µé¢å…ƒç´ å†…éƒ¨

### 2.2 ç»„ä»¶ä¸‰å¤§å±æ€§ 1ï¼š`state`

å®ç°æ•ˆæœ

![state](https://cdn.wallleap.cn/img/pic/illustration/Likeç»„ä»¶.gif)

ç†è§£

- `state` æ˜¯ç»„ä»¶å¯¹è±¡æœ€é‡è¦çš„å±æ€§ï¼Œå€¼æ˜¯å¯¹è±¡ï¼ˆå¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®ï¼‰
- ç»„ä»¶è¢«ç§°ä¸º"çŠ¶æ€æœº"ï¼Œé€šè¿‡æ›´æ–°ç»„ä»¶çš„ `state` æ¥æ›´æ–°å¯¹åº”çš„é¡µé¢æ˜¾ç¤ºï¼ˆé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼‰

ç¼–ç æ“ä½œ

1. åˆå§‹åŒ–çŠ¶æ€ï¼š

    ```javascript
    constructor (props) {
      super(props)
      this.state = {
        stateProp1: value1,
        stateProp2: value2
      }
    }
    ```

2. è¯»å–æŸä¸ªçŠ¶æ€å€¼

    ```javascript
    this.state.statePropertyName
    ```

3. æ›´æ–°çŠ¶æ€-->ç»„ä»¶ç•Œé¢æ›´æ–°

    ```javascript
    this.setState({
      stateProp1 : value1,
      stateProp2 : value2
    })
    ```

å®ç°ä»£ç 

```html
<div id="example"></div>
<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  éœ€æ±‚: è‡ªå®šä¹‰ç»„ä»¶, åŠŸèƒ½è¯´æ˜å¦‚ä¸‹
    1. æ˜¾ç¤ºh2æ ‡é¢˜, åˆå§‹æ–‡æœ¬ä¸º: ä½ å–œæ¬¢æˆ‘
    2. ç‚¹å‡»æ ‡é¢˜æ›´æ–°ä¸º: æˆ‘å–œæ¬¢ä½ 
  */
  // 1.å®šä¹‰ç»„ä»¶
  class Like extends React.Component {
    constructor(props) {
      super(props)
      // åˆå§‹åŒ–çŠ¶æ€
      this.state = {
        isLikeMe: false
      }

      // å°†æ–°å¢æ–¹æ³•ä¸­çš„thiså¼ºåˆ¶ç»‘å®šä¸ºç»„ä»¶å¯¹è±¡
      this.handleClick = this.handleClick.bind(this) // ä¹Ÿå¯ä»¥ä¸åœ¨è¿™é‡Œç»‘å®š
    }

    handleClick() {
      // console.log(this) // handleClickæ˜¯æ–°æ·»åŠ æ–¹æ³•ï¼Œå†…éƒ¨thisé»˜è®¤ä¸æ˜¯ç»„ä»¶å¯¹è±¡ï¼Œè€Œæ˜¯undefined  renderæ˜¯é‡å†™ç»„ä»¶ç±»çš„æ–¹æ³• åˆ°ä¸Šé¢æˆ–ä¸‹é¢ç»‘å®šthis
      // å¾—åˆ°çŠ¶æ€ï¼Œå¹¶å–å
      const isLikeMe = !this.state.isLikeMe
      // æ›´æ–°çŠ¶æ€
      this.setState({isLikeMe}) // isLikeMe: isLikeMe
    }
    render() {
      // è¯»å–çŠ¶æ€
      // const isLikeMe = this.state.isLikeMe
      const {isLikeMe} = this.state // è§£æ„èµ‹å€¼
      return <h2 onClick={this.handleClick}>{isLikeMe?'ä½ å–œæ¬¢æˆ‘':'æˆ‘å–œæ¬¢ä½ '}</h2> // thisâ€”â€”ç»„ä»¶å¯¹è±¡ // this.handleClick.bind(this) â€”â€” åœ¨è¿™é‡Œç»‘å®šä¹Ÿå¯ä»¥
    }
  }
  // 2.æ¸²æŸ“ç»„ä»¶æ ‡ç­¾
  ReactDOM.render(<Like />, document.getElementById('example'))
</script>
```

### 2.3 ç»„ä»¶ä¸‰å¤§å±æ€§ 2ï¼š`props`

å®ç°æ•ˆæœ

```md
éœ€æ±‚ï¼šè‡ªå®šä¹‰ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªäººå‘˜ä¿¡æ¯çš„ç»„ä»¶

1. å§“åå¿…é¡»æŒ‡å®š
2. å¦‚æœæ€§åˆ«æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º ç”·
3. å¦‚æœå¹´é¾„æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º 18
```

![props](https://cdn.wallleap.cn/img/pic/illustration/react-4.png)

ç†è§£

- æ¯ä¸ªç»„ä»¶å¯¹è±¡éƒ½ä¼šæœ‰ `props`ï¼ˆproperties çš„ç®€å†™ï¼‰å±æ€§
- ç»„ä»¶æ ‡ç­¾çš„æ‰€æœ‰å±æ€§éƒ½ä¿å­˜åœ¨ `props` ä¸­

ä½œç”¨

- é€šè¿‡æ ‡ç­¾å±æ€§ä»ç»„ä»¶å¤–å‘ç»„ä»¶å†…ä¼ é€’å˜åŒ–çš„æ•°æ®
- æ³¨æ„ï¼šç»„ä»¶å†…éƒ¨ä¸è¦ä¿®æ”¹ `props` æ•°æ®

ç¼–ç æ“ä½œ

1. å†…éƒ¨è¯»å–æŸä¸ªå±æ€§å€¼ `this.props.propertyName`
2. å¯¹ `props` ä¸­çš„å±æ€§å€¼è¿›è¡Œç±»å‹é™åˆ¶å’Œå¿…è¦æ€§é™åˆ¶

    > æ³¨æ„ï¼š
    >
    > è‡ª React v15.5 èµ·ï¼Œ`React.PropTypes` å·²ç§»å…¥å¦ä¸€ä¸ªåŒ…ä¸­ã€‚è¯·ä½¿ç”¨ [`prop-types` åº“](https://www.npmjs.com/package/prop-types) ä»£æ›¿ã€‚éœ€è¦å…ˆå¼•å…¥è¯¥åº“ã€‚
    >
    > æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª [codemod è„šæœ¬](https://react.docschina.org/blog/2017/04/07/react-v15.5.0.html#migrating-from-reactproptypes)æ¥åšè‡ªåŠ¨è½¬æ¢ã€‚

    ```javascript
    Person.propTypes = {
      name: React.PropTypes.string.isRequired,
      age: React.PropTypes.number.isRequired
    }
    ```

3. æ‰©å±•å±æ€§ï¼šå°†å¯¹è±¡çš„æ‰€æœ‰å±æ€§é€šè¿‡ `props` ä¼ é€’ `<Person {...person}/>`

4. é»˜è®¤å±æ€§å€¼

    ```javascript
    Person.defaultProps = {
      name: 'Mary'
    }
    ```

5. ç»„ä»¶ç±»çš„æ„é€ å‡½æ•°

    ```javascript
    constructor (props) {
      super(props)
      console.log(props) // æŸ¥çœ‹æ‰€æœ‰å±æ€§
    }
    ```

ä»£ç 

```html
<div id="example1"></div>
<div id="example2"></div>
<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/prop-types.js"></script> <!-- éªŒè¯ç±»å‹å’Œå¿…è¦æ€§ -->
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
éœ€æ±‚: è‡ªå®šä¹‰ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªäººå‘˜ä¿¡æ¯çš„ç»„ä»¶, æ•ˆæœå¦‚é¡µé¢. è¯´æ˜
  1). å¦‚æœæ€§åˆ«æ²¡æœ‰æŒ‡å®š, é»˜è®¤ä¸ºç”·
  2). å¦‚æœå¹´é¾„æ²¡æœ‰æŒ‡å®š, é»˜è®¤ä¸º18
  */

  // 1ã€å®šä¹‰ç»„ä»¶
  /*function Person(props){
    return (
      <ul>
        <li>å§“åï¼š{props.name}</li>
        <li>æ€§åˆ«ï¼š{props.sex}</li>
        <li>å¹´é¾„ï¼š{props.age}</li>
      </ul>
    )
  }*/
  class Person extends React.Component{
    render(){
      return (
        <ul>
          <li>å§“åï¼š{this.props.name}</li>  // thisâ€”â€”ç»„ä»¶å¯¹è±¡
          <li>æ€§åˆ«ï¼š{this.props.sex}</li>
          <li>å¹´é¾„ï¼š{this.props.age}</li>
        </ul>
      )
    }
  }
  // æŒ‡å®šå±æ€§é»˜è®¤å€¼
  Person.defaultProps = {
    sex: 'ç”·',
    age: 18
  }
  // æŒ‡å®šå±æ€§å€¼çš„ç±»å‹å’Œå¿…è¦æ€§
  Person.propTypes = {
    name: PropTypes.string.isRequired,
    age: PropTypes.number
  }

  // 2ã€æ¸²æŸ“ç»„ä»¶æ ‡ç­¾
  const p1 = {
    name: 'Tom',
    sex: 'å¥³',
    age: 18
  }
  // ReactDOM.render(<Person name={p1.name} sex={p1.sex} age={p1.age}/>, document.getElementById('example1'))
  ReactDOM.render(<Person {...p1}/>, document.getElementById('example1')) // ...ä½œç”¨ï¼š1.æ‰“åŒ…ï¼šfunction fn(...as){} fun(1,2,3) 2.è§£åŒ…ï¼šconst arr1=[1,2,3] const arr2=[6,...arr1,9] è¿™é‡Œä¹Ÿæ˜¯åœ¨è§£åŒ…
  const p2 = {
    name: 'JACK',
    age: 17
  }
  ReactDOM.render(<Person name={p2.name} age={p2.age}/>, document.getElementById('example2'))
</script>
```

> ğŸ”– é¢è¯•é¢˜ï¼šè¯·åŒºåˆ«ä¸€ä¸‹ç»„ä»¶çš„ `props` å’Œ `state` å±æ€§

- `state`ï¼š**ç»„ä»¶è‡ªèº«å†…éƒ¨å¯å˜åŒ–çš„æ•°æ®**

- `props`ï¼šä»ç»„ä»¶**å¤–éƒ¨**å‘ç»„ä»¶å†…éƒ¨**ä¼ é€’æ•°æ®**ï¼Œç»„ä»¶å†…éƒ¨**åªè¯»**ä¸ä¿®æ”¹

### 2.4 ç»„ä»¶ä¸‰å¤§å±æ€§ 3ï¼š`refs` ä¸äº‹ä»¶å¤„ç†

æ•ˆæœ

```md
éœ€æ±‚ï¼šè‡ªå®šä¹‰ç»„ä»¶ï¼ŒåŠŸèƒ½è¯´æ˜å¦‚ä¸‹

1. ç‚¹å‡»æŒ‰é’®ï¼Œæç¤ºç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ä¸­çš„å€¼
2. å½“ç¬¬ 2 ä¸ªè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œæç¤ºè¿™ä¸ªè¾“å…¥æ¡†ä¸­çš„å€¼
```

![props_event](https://cdn.wallleap.cn/img/pic/illustration/props_event.gif)

`refs` å±æ€§

- ç»„ä»¶å†…çš„æ ‡ç­¾éƒ½å¯ä»¥å®šä¹‰ `ref` å±æ€§æ¥æ ‡è¯†è‡ªå·±

  1. `<input type="text" ref={input => this.msgInput = input}/>`

  2. å›è°ƒå‡½æ•°åœ¨ç»„ä»¶åˆå§‹åŒ–æ¸²æŸ“å®Œæˆ–å¸è½½æ—¶è‡ªåŠ¨è°ƒç”¨

- åœ¨ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ `this.msgInput` æ¥å¾—åˆ°å¯¹åº”çš„çœŸå® DOM å…ƒç´ 

- ä½œç”¨ï¼šé€šè¿‡ `ref` è·å–ç»„ä»¶å†…å®¹ç‰¹å®šæ ‡ç­¾å¯¹è±¡ï¼Œè¿›è¡Œè¯»å–å…¶ç›¸å…³æ•°æ®

äº‹ä»¶å¤„ç†

- é€šè¿‡ `onXxx` å±æ€§æŒ‡å®šç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰

  - React ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ï¼ˆåˆæˆï¼‰äº‹ä»¶, è€Œä¸æ˜¯ä½¿ç”¨çš„åŸç”Ÿ DOM äº‹ä»¶

  - React ä¸­çš„äº‹ä»¶æ˜¯é€šè¿‡äº‹ä»¶å§”æ‰˜æ–¹å¼å¤„ç†çš„ï¼ˆå§”æ‰˜ç»™ç»„ä»¶æœ€å¤–å±‚çš„å…ƒç´ ï¼‰

- é€šè¿‡ `event.target` å¾—åˆ°å‘ç”Ÿäº‹ä»¶çš„ DOM å…ƒç´ å¯¹è±¡

```js
handleFocus(event) {
  event.target // è¿”å›inputå¯¹è±¡
}
```

å¼ºçƒˆæ³¨æ„

- ç»„ä»¶å†…ç½®çš„æ–¹æ³•ä¸­çš„ `this` ä¸ºç»„ä»¶å¯¹è±¡
- åœ¨ç»„ä»¶ç±»ä¸­è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­ `this` ä¸º `null`
- å¼ºåˆ¶ç»‘å®š `this`ï¼šé€šè¿‡å‡½æ•°å¯¹è±¡çš„ `bind()` / `apply()` / `call()` æ¥æŒ‡å®š `this`
- ç®­å¤´å‡½æ•°æ²¡æœ‰ `this`ï¼Œç®­å¤´å‡½æ•°å†…éƒ¨çš„ `this` æ˜¯ä¸Šä¸‹æ–‡ä¸­çš„ `this`ï¼ˆç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒçš„ `this` æ˜¯å¤–é¢çš„ `this`ï¼‰

ä»£ç 

```html
<div id="example"></div>
<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  éœ€æ±‚: è‡ªå®šä¹‰ç»„ä»¶, åŠŸèƒ½è¯´æ˜å¦‚ä¸‹:
    1. ç•Œé¢å¦‚æœé¡µé¢æ‰€ç¤º
    2. ç‚¹å‡»æŒ‰é’®, æç¤ºç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ä¸­çš„å€¼
    3. å½“ç¬¬2ä¸ªè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶, æç¤ºè¿™ä¸ªè¾“å…¥æ¡†ä¸­çš„å€¼
 */
  // 1ã€å®šä¹‰ç»„ä»¶ // Reactä¸­å¿…é¡»è¦ç»“æŸæ ‡ç­¾
  class MyComponent extends React.Component{
    constructor(props){
      super(props)
      this.showInput = this.showInput.bind(this)
      this.handleBlur = this.handleBlur.bind(this)
    }

    showInput(){
      const input = this.refs.content
      // alert(input.value)
      alert(this.input.value)
    }

    handleBlur(event){
      alert(event.target.value)
    }

    render(){
      return(
        <div>
          <input type="text" ref="content"/>&nbsp;&nbsp;
          <input type="text" ref={input => this.input = input}/>&nbsp;&nbsp;
          <button onClick={this.showInput}>æç¤ºè¾“å…¥</button>&nbsp;&nbsp;
          <input type="text" placeholder="å¤±å»ç„¦ç‚¹æç¤ºå†…å®¹" onBlur={this.handleBlur}/>
        </div>
      )
    }
  }

  // 2ã€æ¸²æŸ“ç»„ä»¶æ ‡ç­¾
  ReactDOM.render(<MyComponent/>, document.getElementById('example'))
</script>
```

### 2.5 ç»„ä»¶çš„ç»„åˆ

æ•ˆæœ

```md
åŠŸèƒ½ï¼šç»„ä»¶åŒ–å®ç°æ­¤åŠŸèƒ½

1. æ˜¾ç¤ºæ‰€æœ‰ todo åˆ—è¡¨
2. è¾“å…¥æ–‡æœ¬ï¼Œç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºåˆ°åˆ—è¡¨çš„é¦–ä½ï¼Œå¹¶æ¸…é™¤è¾“å…¥çš„æ–‡æœ¬
```

![componentç»„åˆä½¿ç”¨](https://cdn.wallleap.cn/img/pic/illustration/componentç»„åˆä½¿ç”¨.gif)

åŠŸèƒ½ç•Œé¢çš„ç»„ä»¶åŒ–ç¼–ç æµç¨‹ï¼ˆæ— æ¯”é‡è¦ï¼‰

1. æ‹†åˆ†ç»„ä»¶ï¼šæ‹†åˆ†ç•Œé¢ï¼ŒæŠ½å–ç»„ä»¶

2. å®ç°é™æ€ç»„ä»¶ï¼šä½¿ç”¨ç»„ä»¶å®ç°é™æ€é¡µé¢æ•ˆæœï¼ˆåªæœ‰é™æ€ç•Œé¢ï¼Œæ²¡æœ‰åŠ¨æ€æ•°æ®å’Œäº¤äº’ï¼‰

3. å®ç°åŠ¨æ€ç»„ä»¶

   - å®ç°åˆå§‹åŒ–æ•°æ®åŠ¨æ€æ˜¾ç¤º

   - å®ç°äº¤äº’åŠŸèƒ½(ä»ç»‘å®šäº‹ä»¶ç›‘å¬å¼€å§‹)

ä»£ç 

```html
<div id="example"></div>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/prop-types.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  // é™æ€ç»„ä»¶â€”â€”>åŠ¨æ€ç»„ä»¶
  /*
  * -åç§°ã€ç±»å‹ï¼štodosã€æ•°ç»„ï¼ŒAddéœ€è¦ã€Listéœ€è¦
  * -æ•°æ®ä¿å­˜åœ¨å“ªä¸ªç»„ä»¶å†…ï¼Ÿ
  *   æ”¾åˆ°App
  *   çœ‹æ•°æ®æ˜¯æŸä¸ªç»„ä»¶éœ€è¦(ç»™è¿™ä¸ª)ï¼Œè¿˜æ˜¯æŸäº›ç»„ä»¶éœ€è¦(ç»™å…±åŒçš„çˆ¶ç»„ä»¶)
  * -éœ€è¦åœ¨å­ç»„ä»¶ä¸­æ”¹å˜çˆ¶ç»„ä»¶çš„çŠ¶æ€
  *    å­ç»„ä»¶ä¸­ä¸èƒ½ç›´æ¥æ”¹å˜çˆ¶ç»„ä»¶çš„çŠ¶æ€
  *    çŠ¶æ€åœ¨å“ªä¸ªç»„ä»¶ï¼Œæ›´æ–°çŠ¶æ€çš„è¡Œä¸ºå°±åº”è¯¥å®šä¹‰åœ¨å“ªä¸ªç»„ä»¶ï¼Œç”±å­ç»„ä»¶æ¥è°ƒç”¨(é€šè¿‡ç»„ä»¶å±æ€§ä¼ é€’)
  *    çˆ¶ç»„ä»¶å®šä¹‰å‡½æ•°ï¼Œä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶è°ƒç”¨
  */
  class App extends React.Component{

    constructor(props){
      super(props)
      // åˆå§‹åŒ–çŠ¶æ€
      this.state = {
        todos: ['åƒé¥­', 'ç¡è§‰', 'æ•²ä»£ç ', 'æ‰“æ¸¸æˆ']
      }

      this.addTodo = this.addTodo.bind(this)  // æ²¡å®šä¹‰åŠ ä¸Šbind
    }

    addTodo(todo){
      // this.state.todos.unshift(todo) // ä¸èƒ½è¿™æ ·åš
      const {todos} = this.state
      todos.unshift(todo)
      // æ›´æ–°çŠ¶æ€
      this.setState({todos})
    }

    render(){
      const {todos} = this.state
      return(
        <div>
          <h1>Simple TODO List</h1>
          <Add count={todos.length} addTodo={this.addTodo}/>
          <List todos={todos}/>
        </div>
      )
    //  <List todos={this.state.todos}/> å‰é¢èµ‹å€¼äº†
    }
  }

  class Add extends React.Component{
    constructor(props){
      super(props)
      this.add = this.add.bind(this)
    }
    add(){
      // 1ã€è¯»å–è¾“å…¥çš„æ•°æ®
      const todo = this.todoInput.value.trim()
      // 2ã€æ£€æŸ¥åˆæ³•æ€§
      if(!todo){
        return
      }
      // 3ã€æ·»åŠ 
      this.props.addTodo(todo)
      // 4ã€æ¸…é™¤è¾“å…¥
      this.todoInput.value = ''
    }
    render(){
      return(
        <div>
          <input type="text" ref={input => this.todoInput=input}/>
          <button onClick={this.add}>add #{this.props.count+1}</button>
        </div>
      )
    }
  }
  Add.propTypes = {
    count: PropTypes.number.isRequired,
    addTodo: PropTypes.func.isRequired
  }

  class List extends React.Component{
    render(){
      return(
        <ul>
          {
            this.props.todos.map((todo, index) => <li key={index}>{todo}</li>)
          }
        </ul>
      )
      /*this.props.todos.map((todo, index) => {return <li key={index}>{todo}</li>})*/
      /* åŠ äº†å¤§æ‹¬å·éœ€è¦åŠ return */
    }
  }

  List.protoTypes = {
    todos: PropTypes.array.isRequired
  }


  ReactDOM.render(<App />,document.getElementById('example'))
</script>
```

### 2.6 æ”¶é›†è¡¨å•æ•°æ®

æ•ˆæœ

```md
éœ€æ±‚ï¼šè‡ªå®šä¹‰åŒ…å«è¡¨å•çš„ç»„ä»¶

1. è¾“å…¥ç”¨æˆ·åå¯†ç åï¼Œç‚¹å‡»ç™»é™†æç¤ºè¾“å…¥ä¿¡æ¯
2. ä¸æäº¤è¡¨å•
```

![componentè¡¨å• (2)](https://cdn.wallleap.cn/img/pic/illustration/componentè¡¨å•.gif)

ç†è§£

- é—®é¢˜ï¼šåœ¨ react åº”ç”¨ä¸­ï¼Œå¦‚ä½•æ”¶é›†è¡¨å•è¾“å…¥æ•°æ®

- åŒ…å«è¡¨å•çš„ç»„ä»¶åˆ†ç±»

  - å—æ§ç»„ä»¶ï¼šè¡¨å•é¡¹è¾“å…¥æ•°æ®èƒ½è‡ªåŠ¨æ”¶é›†æˆçŠ¶æ€

  - éå—æ§ç»„ä»¶ï¼šéœ€è¦æ—¶æ‰æ‰‹åŠ¨è¯»å–è¡¨å•è¾“å…¥æ¡†ä¸­çš„æ•°æ®

ä»£ç 

```html
<div id="example"></div>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  éœ€æ±‚: è‡ªå®šä¹‰åŒ…å«è¡¨å•çš„ç»„ä»¶
    1. ç•Œé¢å¦‚ä¸‹æ‰€ç¤º
    2. è¾“å…¥ç”¨æˆ·åå¯†ç å, ç‚¹å‡»ç™»é™†æç¤ºè¾“å…¥ä¿¡æ¯
    3. ä¸æäº¤è¡¨å•
  */
  class LoginForm extends React.Component{
    constructor(props){
      super(props)
      // åˆå§‹åŒ–çŠ¶æ€
      this.state  = {
        pwd: ''
      }
      this.handleSubmit = this.handleSubmit.bind(this)
      this.handleChange = this.handleChange.bind(this)
    }

    handleSubmit(event){
      const name = this.nameInput.value // éå—æ§ç»„ä»¶
      const {pwd} = this.state // å—æ§ç»„ä»¶
      alert(`å‡†å¤‡æäº¤çš„ç”¨æˆ·åä¸º${name}ï¼Œå¯†ç ä¸º${pwd}`)
      // é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸º
      event.preventDefault()
    }
    // å½“äº‹ä»¶å’Œæ ‡ç­¾æ˜¯åŒä¸€ä¸ªæ—¶ï¼Œä½¿ç”¨eventæ›´æ–¹ä¾¿

    handleChange(event){
      // è¯»å–è¾“å…¥çš„å€¼
      const pwd = event.target.value
      // æ›´æ–°pwdçš„çŠ¶æ€
      this.setState({pwd})
    }

    render(){
      return(
        <form action="/test" onSubmit={this.handleSubmit}>
          ç”¨æˆ·åï¼š<input type="text" ref={input => this.nameInput = input}/>
          å¯†ç ï¼š<input type="password" value={this.state.pwd} onChange={this.handleChange}/>
          <input type="submit" value="ç™»å½•"/>
        </form>
      )
    }
    // åŸç”ŸjsonChangeäº‹ä»¶æ˜¯åœ¨å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ï¼Œreactä¸­æ˜¯è¾“å…¥åˆ™è§¦å‘
  }
  
  ReactDOM.render(<LoginForm />, document.getElementById('example'))
</script>
```

### 2.7 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

æ•ˆæœ

```md
éœ€æ±‚ï¼šè‡ªå®šä¹‰ç»„ä»¶

1. è®©æŒ‡å®šçš„æ–‡æœ¬åšæ˜¾ç¤º/éšè—çš„æ¸å˜åŠ¨ç”»
2. åˆ‡æ¢æŒç»­æ—¶é—´ä¸º 2s
3. ç‚¹å‡»æŒ‰é’®ä»ç•Œé¢ä¸­ç§»é™¤ç»„ä»¶ç•Œé¢
```

![componentç”Ÿå‘½å‘¨æœŸ](https://cdn.wallleap.cn/img/pic/illustration/componentç”Ÿå‘½å‘¨æœŸ.gif)

ç†è§£

- ç»„ä»¶å¯¹è±¡ä»åˆ›å»ºåˆ°æ­»äº¡å®ƒä¼šç»å†ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

- React ç»„ä»¶å¯¹è±¡åŒ…å«ä¸€ç³»åˆ—çš„å‹¾å­å‡½æ•°ï¼ˆç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°ï¼‰ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸç‰¹å®šæ—¶åˆ»å›è°ƒ

- åœ¨å®šä¹‰ç»„ä»¶æ—¶ï¼Œå¯ä»¥é‡å†™ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°ï¼Œåšç‰¹å®šçš„å·¥ä½œ

ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾

![ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾](https://cdn.wallleap.cn/img/pic/illustration/reactlife.png)

Mountï¼šæŒ‚è½½ï¼Œå°†è™šæ‹Ÿæ ‡ç­¾æ”¾åˆ°å®¹å™¨ï¼ˆé¡µé¢ï¼‰ä¸­

render() æ¸²æŸ“

å·¦è¾¹åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™äº›æ–¹æ³•ç§°ä¸ºå£°æ˜å‘¨æœŸå›è°ƒå‡½æ•°ï¼Œæˆ–ç§°ä¸ºç”Ÿå‘½å‘¨æœŸçš„å‹¾å­ï¼Œè¿™äº›æ–¹æ³•åœ¨ç‰¹å®šçš„æ—¶åˆ»è°ƒç”¨

> å›è°ƒå‡½æ•°ï¼šä½ å®šä¹‰çš„ï¼Œä½ æ²¡æœ‰è°ƒç”¨ï¼Œä½†æ˜¯æœ€ç»ˆæ‰§è¡Œäº†ï¼›å£°æ˜å¼ç¼–ç¨‹ï¼Œæµç¨‹è®¾å®šå¥½ï¼Œå‘½ä»¤å¼ç¼–ç¨‹ jQueryï¼Œæ¯ä¸€æ­¥è‡ªå·±æ“ä½œ

will å°†ã€did å®Œæˆ

ç”Ÿå‘½å‘¨æœŸè¯¦è¿°

- ç»„ä»¶çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€:

  - Mountï¼šæ’å…¥çœŸå® DOM

  - Updateï¼šè¢«é‡æ–°æ¸²æŸ“

  - Unmountï¼šè¢«ç§»å‡ºçœŸå® DOM

- React ä¸ºæ¯ä¸ªçŠ¶æ€éƒ½æä¾›äº†å‹¾å­ï¼ˆhookï¼‰å‡½æ•°ï¼Œå¯é‡å†™

  - `componentWillMount()`

  - `componentDidMount()`

  - `componentWillUpdate()`

  - `componentDidUpdate()`

  - `componentWillUnmount()`

- ç”Ÿå‘½å‘¨æœŸæµç¨‹:

  1. ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ¸²æŸ“æ˜¾ç¤ºï¼š`ReactDOM.render()`

     - constructor()ï¼šåˆ›å»ºå¯¹è±¡åˆå§‹åŒ– state

     - componentWillMount()ï¼šå°†è¦æ’å…¥å›è°ƒ

     - render()ï¼šç”¨äºæ’å…¥è™šæ‹Ÿ DOM å›è°ƒ

     - componentDidMount()ï¼šå·²ç»æ’å…¥å›è°ƒ

  2. æ¯æ¬¡æ›´æ–° stateï¼š`this.setSate()`

     - componentWillUpdate()ï¼šå°†è¦æ›´æ–°å›è°ƒ

     - render()ï¼šæ›´æ–°ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰

     - componentDidUpdate()ï¼šå·²ç»æ›´æ–°å›è°ƒ

  3. ç§»é™¤ç»„ä»¶ï¼š`ReactDOM.unmountComponentAtNode(containerDom)`

     - componentWillUnmount()ï¼šç»„ä»¶å°†è¦è¢«ç§»é™¤å›è°ƒ

ä¸‰ä¸ªé˜¶æ®µï¼Œå¯ä»¥éƒ½æ‰“å°ä¸€ä¸‹ï¼Œçœ‹ä¸‹æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ï¼ˆä¸å†™çš„é¡ºåºæ— å…³ï¼Œä½†æ¨èæŒ‰é˜¶æ®µçš„é¡ºåºå†™ï¼Œæ›´ç›´è§‚ï¼‰

é‡è¦çš„å‹¾å­

- render()ï¼šåˆå§‹åŒ–æ¸²æŸ“æˆ–æ›´æ–°æ¸²æŸ“è°ƒç”¨

- componentDidMount()ï¼šå¼€å¯ç›‘å¬ï¼Œå‘é€ ajax è¯·æ±‚

- componentWillUnmount()ï¼šåšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œå¦‚æ¸…ç†å®šæ—¶å™¨

- componentWillReceiveProps()ï¼šåé¢éœ€è¦æ—¶è®²

ä»£ç 

```html
<div id="example"></div>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  éœ€æ±‚: è‡ªå®šä¹‰ç»„ä»¶
    1. è®©æŒ‡å®šçš„æ–‡æœ¬åšæ˜¾ç¤º/éšè—çš„åŠ¨ç”»
    2. åˆ‡æ¢æ—¶é—´ä¸º2S
    3. ç‚¹å‡»æŒ‰é’®ä»ç•Œé¢ä¸­ç§»é™¤ç»„ä»¶ç•Œé¢
   */
  class Life extends React.Component{
    constructor(props){
      super(props)
      // åˆå§‹åŒ–çŠ¶æ€
      this.state = {
        opacity: 1
      }

      this.distroyComponent = this.distroyComponent.bind(this)
    }

    distroyComponent(){
      ReactDOM.unmountComponentAtNode(document.getElementById('example'))
    }

    // é‡å†™æ–¹æ³•
    componentDidMount(){
      // å¯åŠ¨å¾ªç¯å®šæ—¶å™¨
      this.intervalId = setInterval(function () { // ä¸¤ä¸ªå‡½æ•°éœ€è¦åŒä¸€ä¸ªå˜é‡ï¼Œæ”¾åˆ°ä¸Šä¸€å±‚å…±åŒç»„ä»¶ä¸Š
        console.log('å®šæ—¶å™¨æ‰§è¡Œâ€¦â€¦')
        let {opacity} = this.state
        opacity -= 0.1
        if(opacity<=0){
          opacity = 1
        }
        // æ›´æ–°çŠ¶æ€
        this.setState({opacity})
      }.bind(this), 200) // componentDidMountçš„this
    }
    componentWillUnmount(){
      // æ¸…ç†å®šæ—¶å™¨
      clearInterval(this.intervalId)
    }

    render(){ // ä¸€æ—¦æ”¹å˜ï¼Œå°±ä¼šé‡æ–°è°ƒç”¨;æ°¸è¿œå†™åœ¨å…¶ä»–ä¸‹æ–¹ï¼Œæ„é€ å™¨åœ¨æœ€ä¸Šæ–¹
      const {opacity} = this.state
      return(
        <div>
          <h2 style={{opacity: opacity}}>{this.props.msg}</h2>
          <button onClick={this.distroyComponent}>ä¸æ´»äº†</button>
        </div>
      )
    } // styleä¸­ä¸¤ä¸ªå¤§æ‹¬å·ï¼Œå¤–é¢çš„ä»£è¡¨å†™çš„æ˜¯jsä»£ç ï¼Œé‡Œé¢çš„æ˜¯å¯¹è±¡ï¼ˆæ ·å¼åï¼šå€¼ï¼Œä¹Ÿå¯ä»¥å†™ES6ï¼‰
  }

  ReactDOM.render(<Life msg="reactå¤ªéš¾äº†"/>, document.getElementById('example'))
</script>
```

### 2.8 è™šæ‹Ÿ DOM ä¸ DOM Diff ç®—æ³•

è™šæ‹Ÿ DOMï¼šå‡å°‘æ“ä½œçœŸå® DOM çš„æ¬¡æ•°ï¼Œæ›´æ–°ç•Œé¢æ¬¡æ•°å˜å°‘

DOM Diff ç®—æ³•ï¼šè®¡ç®—å“ªé‡Œéœ€è¦æ›´æ–°ï¼Œå“ªé‡Œä¸éœ€è¦æ›´æ–°ï¼Œå‡å°‘æ›´æ–°ç•Œé¢çš„åŒºåŸŸ

å…±åŒæé«˜æ›´æ–°ç•Œé¢çš„æ•ˆç‡

æ•ˆæœ

![componentè™šæ‹ŸDOM](https://cdn.wallleap.cn/img/pic/illustration/vDOM.gif)

```html
<div id="example"></div>
<br>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  éªŒè¯:
  è™šæ‹ŸDOM+DOM Diffç®—æ³•: æœ€å°åŒ–é¡µé¢é‡ç»˜
  */

  class HelloWorld extends React.Component {
    constructor(props) {
      super(props)
      this.state = {
        date: new Date()
      }
    }

    componentDidMount () {
      setInterval(() => {
        this.setState({
          date: new Date()
        })
      }, 1000)
    }

    render () {
      console.log('render()')
      return (
        <p>
          Hello, <input type="text" placeholder="Your name here"/>!&nbsp;
          <span>It is {this.state.date.toTimeString()}</span>
        </p>
      )
    }
  }

  ReactDOM.render(
    <HelloWorld/>,
    document.getElementById('example')
  )
</script>
```

åªæœ‰æ—¶é—´æ›´æ–°ï¼Œå…¶ä»–ä¸æ›´æ–°

åŸºæœ¬åŸç†å›¾

![åŸºæœ¬åŸç†](https://cdn.wallleap.cn/img/pic/illustration/react-5.png)

- åˆå§‹åŒ–ï¼šè™šæ‹Ÿ DOM æ ‘(div>p>spanâ€¦â€¦)ï¼Œæ›´æ–°è™šæ‹Ÿ DOM ç•Œé¢ä¸ä¼šå˜â€”â€”>æ›´æ–°çœŸå® DOM ç•Œé¢æ‰ä¼šå˜åŒ–ï¼ˆæ›´æ–°çŠ¶æ€ï¼‰

- æ›´æ–°ï¼ˆå…³é”®ï¼‰ï¼šè°ƒç”¨ setState() æ›´æ–°çŠ¶æ€ï¼ˆä¼šè¿›è¡Œå¯¹æ¯”ï¼‰â€”â€”>æ ¹æ®å·®å¼‚æ›´æ–°çœŸå® DOMã€é‡ç»˜é¡µé¢å˜åŒ–çš„åŒºåŸŸ

## ä¸‰ã€react åº”ç”¨ï¼ˆåŸºäº react è„šæ‰‹æ¶ï¼‰

### 3.1 ä½¿ç”¨ create-react-app åˆ›å»º react åº”ç”¨

reactè„šæ‰‹æ¶

- xxxè„šæ‰‹æ¶ï¼šç”¨æ¥å¸®åŠ©ç¨‹åºå‘˜å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäºxxxåº“çš„æ¨¡æ¿é¡¹ç›®

  - åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„é…ç½®

  - æŒ‡å®šå¥½äº†æ‰€æœ‰çš„ä¾èµ–

  - å¯ä»¥ç›´æ¥å®‰è£…/ç¼–è¯‘/è¿è¡Œä¸€ä¸ªç®€å•æ•ˆæœ

- react æä¾›äº†ä¸€ä¸ªç”¨äºåˆ›å»º react é¡¹ç›®çš„è„šæ‰‹æ¶åº“ï¼šcreate-react-app

- é¡¹ç›®çš„æ•´ä½“æŠ€æœ¯æ¶æ„ä¸ºï¼šreact + webpack + es6 + eslint

- ä½¿ç”¨è„šæ‰‹æ¶å¼€å‘çš„é¡¹ç›®çš„ç‰¹ç‚¹ï¼šæ¨¡å—åŒ–ã€ç»„ä»¶åŒ–ã€å·¥ç¨‹åŒ–

åˆ›å»ºé¡¹ç›®å¹¶å¯åŠ¨

```sh
npm install -g create-react-app  # å…¨å±€ä¸‹è½½
create-react-app hello-react
cd hello-react
npm start
```

æµè§ˆå™¨è®¿é—® <http://localhost:3000>

æ³¨ï¼š

```sh
npm root -g  # æŸ¥çœ‹å…¨å±€ä¸‹è½½ç›®å½•
```

C:\Users\Shinelon\AppData\Roaming\npm\node_modules

react è„šæ‰‹æ¶é¡¹ç›®ç»“æ„

```md
ReactNews

 |--node_modules---ç¬¬ä¸‰æ–¹ä¾èµ–æ¨¡å—æ–‡ä»¶å¤¹

 |--public

   |-- index.html-----------------ä¸»é¡µé¢

 |--scripts

   |-- build.js-------------------buildæ‰“åŒ…å¼•ç”¨é…ç½®

   |-- start.js-------------------startè¿è¡Œå¼•ç”¨é…ç½®

 |--src------------æºç æ–‡ä»¶å¤¹

   |--components-----------------reactç»„ä»¶
   
      |-- app.jsx
      
   |--index.css
   
   |--index.js-------------------åº”ç”¨å…¥å£js(main.js)

 |--.gitignore------gitç‰ˆæœ¬ç®¡åˆ¶å¿½ç•¥çš„é…ç½®

 |--package.json----åº”ç”¨åŒ…é…ç½®æ–‡ä»¶ 

 |--README.md-------åº”ç”¨æè¿°è¯´æ˜çš„readmeæ–‡ä»¶
```

`package.json`

- `"dependencies"`ï¼šè¿è¡Œæ—¶ä¾èµ–
- `"devDependencies"`ï¼šå¼€å‘æ—¶ä¾èµ–ï¼Œç¼–è¯‘æ‰“åŒ…æ—¶éœ€è¦ï¼Œå¼€å‘æ—¶ä¸éœ€è¦ï¼Œç¼–è¯‘æ‰“åŒ…æ—¶å·¥å…·åŒ…

`public/index.html` ä¸»ç•Œé¢

- åªæœ‰ä¸€ä¸ª `<div id="root"></div>`ï¼Œä¾é ç»„ä»¶

`src/index.js` åº”ç”¨å…¥å£

- å¼•å…¥åŒ…(`import * from "*"`)ã€CSS(`import "*.css"`)
- æ¸²æŸ“ç»„ä»¶

`README.md`å¯¹é¡¹ç›®çš„è¯´æ˜æ–‡ä»¶

SPA(Single Page Application)ï¼šå•åº”ç”¨

`index.html`

```html
<div id="root"></div>
```

`src/components/app.jsx`

```jsx
import React, {Component} from 'react'
import logo from '../logo.svg'

export default class App extends Component {
  render() {
    return(
      <div>
        <img className='logo' src={logo} alt="logo"/>
        <p className="title">reactç»„ä»¶</p>
      </div>
    )
  }
}
```

`src/index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import App from './components/app'

import './index.css'

ReactDOM.render(<App />, document.getElementById('root'))
```

`src/index.css`

```css
.logo{
  width: 200px;
  height: 200px;
}
.title{
  color: red;
  font-size: 25px;
}
```

æœ¬åœ°é¢„è§ˆ

`cd react_app`

`npm start` æˆ– `npm run start`

### 3.2 demoï¼šè¯„è®ºç®¡ç†

æ•ˆæœ

![demo_comment](https://cdn.wallleap.cn/img/pic/illustration/demo_comment.gif)

æ‹†åˆ†ç»„ä»¶

![æ‹†åˆ†ç»„ä»¶](https://cdn.wallleap.cn/img/pic/illustration/image-20200708170522553.png)

åº”ç”¨ç»„ä»¶ï¼šApp

- state: comments/array

æ·»åŠ è¯„è®ºç»„ä»¶ï¼šCommentAdd

- state: username/string, content/string

- props: add/func

è¯„è®ºåˆ—è¡¨ç»„ä»¶ï¼šCommentList

- props: comment/object, delete/func, index/number

è¯„è®ºé¡¹ç»„ä»¶ï¼šCommentItem

- props: comments/array, delete/func

å®ç°é™æ€ç»„ä»¶

`render(){return}` ä¸­çš„å†…å®¹

`src/index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import App from './components/app/app'

ReactDOM.render(<App/>, document.getElementById('root'))
```

`src/components/app/app.jsx`

```jsx
import React from 'react'
import CommentAdd from '../comment-add/comment-add'
import CommentList from '../comment-list/comment-list'

export default class App extends React.Component {

  constructor (props) {
    super(props)

    this.state = {
      comments: []
    }

    this.delete = this.delete.bind(this)
  }

  componentDidMount () {
    //æ¨¡æ‹Ÿå¼‚æ­¥è·å–æ•°æ®
    setTimeout(() => {
      const comments = [
        {
          username: "Tom",
          content: "ReactJSå¥½éš¾å•Š!",
          id: Date.now()
        },
        {
          username: "JACK",
          content: "ReactJSè¿˜ä¸é”™!",
          id: Date.now() + 1
        }
      ]
      this.setState({
        comments
      })
    }, 1000)
  }

  add = (comment) => {
    let comments = this.state.comments
    comments.unshift(comment)
    this.setState({ comments })
  }

  delete (index) {
    let comments = this.state.comments
    comments.splice(index, 1)
    this.setState({ comments })
  }

  render () {
    return (
      <div>
        <header className="site-header jumbotron">
          <div className="container">
            <div className="row">
              <div className="col-xs-12">
                <h1>è¯·å‘è¡¨å¯¹Reactçš„è¯„è®º</h1>
              </div>
            </div>
          </div>
        </header>
        <div className="container">
          <CommentAdd add={this.add}/>
          <CommentList comments={this.state.comments} delete={this.delete}/>
        </div>
      </div>
    )
  }
}

// export default App å¯ä»¥å†™åˆ°ä¸Šé¢
```

`src/components/comment-add/comment-add.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'

class CommentAdd extends React.Component {
  constructor (props) {
    super(props)
    this.state = {
      username: '',
      content: ''
    }
    this.addComment = this.addComment.bind(this)
    this.changeUsername = this.changeUsername.bind(this)
    this.changeContent = this.changeContent.bind(this)
  }

  addComment () {
    // æ ¹æ®è¾“å…¥çš„æ•°æ®åˆ›å»ºè¯„è®ºå¯¹è±¡
    let { username, content } = this.state
    let comment = { username, content }
    // æ·»åŠ åˆ°commentsä¸­, æ›´æ–°state
    this.props.add(comment)
    // æ¸…é™¤è¾“å…¥çš„æ•°æ®
    this.setState({
      username: '',
      content: ''
    })
  }

  changeUsername (event) {
    this.setState({
      username: event.target.value
    })
  }

  changeContent (event) {
    this.setState({
      content: event.target.value
    })
  }

  render () {
    return (
      <div className="col-md-4">
        <form className="form-horizontal">
          <div className="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" className="form-control" placeholder="ç”¨æˆ·å"
                  value={this.state.username} onChange={this.changeUsername}/>
          </div>
          <div className="form-group">
            <label>è¯„è®ºå†…å®¹</label>
            <textarea
              className="form-control" rows="6"
              placeholder="è¯„è®ºå†…å®¹"
              value={this.state.content} onChange={this.changeContent}></textarea>
          </div>
          <div className="form-group">
            <div className="col-sm-offset-2 col-sm-10">
              <button type="button" className="btn btn-default pull-right" onClick={this.addComment}>æäº¤</button>
            </div>
          </div>
        </form>
      </div>
    )
  }
}
CommentAdd.propTypes = {
  add: PropTypes.func.isRequired
}

export default CommentAdd
```

`src/components/comment-list/comment-list.css`

```css
.reply {
  margin-top: 0px;
}
```

`src/components/comment-list/comment-list.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'
import CommentItem from '../comment-item/comment-item'
import './commentList.css'
class CommentList extends React.Component {
  constructor (props) {
    super(props)
  }
  render () {
    let comments = this.props.comments
    let display = comments.length > 0 ? 'none' : 'block'
    return (
      <div className="col-md-8">
        <h3 className="reply">è¯„è®ºå›å¤ï¼š</h3>
        <h2 style={{ display: display }}>æš‚æ— è¯„è®ºï¼Œç‚¹å‡»å·¦ä¾§æ·»åŠ è¯„è®º</h2>
        <ul className="list-group">
          {
            comments.map((comment, index) => {
              console.log(comment)
              return <CommentItem comment={comment} key={index} index={index} delete={this.props.delete}/>
            })
          }
        </ul>
      </div>
    )
  }
}
CommentList.propTypes = {
  comments: PropTypes.array.isRequired,
  delete: PropTypes.func.isRequired
}
export default CommentList
```

`src/components/comment-item/comment-item.css`

```css
li {
  transition: .5s;
  overflow: hidden;
}

.handle {
  width: 40px;
  border: 1px solid #ccc;
  background: #fff;
  position: absolute;
  right: 10px;
  top: 1px;
  text-align: center;
}

.handle a {
  display: block;
  text-decoration: none;
}

.list-group-item .centence {
  padding: 0px 50px;
}

.user {
  font-size: 22px;
}
```

`src/components/comment-item/comment-item.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'
import './commentItem.css'

class CommentItem extends React.Component {
  constructor (props) {
    super(props)
    this.deleteComment = this.deleteComment.bind(this)
  }

  deleteComment () {
    let username = this.props.comment.username
    if (window.confirm(`ç¡®å®šåˆ é™¤${username}çš„è¯„è®ºå—?`)) {
      this.props.delete(this.props.index)
    }
  }

  render () {
    let comment = this.props.comment
    return (
      <li className="list-group-item">
        <div className="handle">
          <a href="javascript:" onClick={this.deleteComment}>åˆ é™¤</a>
        </div>
        <p className="user"><span >{comment.username}</span><span>è¯´:</span></p>
        <p className="centence">{comment.content}</p>
      </li>
    )
  }
}
CommentItem.propTypes = {
  comment: PropTypes.object.isRequired,
  index: PropTypes.number.isRequired,
  delete: PropTypes.func.isRequired
}

export default CommentItem
```

å®ç°åŠ¨æ€ç»„ä»¶

åŠ¨æ€å±•ç¤ºåˆå§‹åŒ–æ•°æ®

- åˆå§‹åŒ–çŠ¶æ€æ•°æ®

- ä¼ é€’å±æ€§æ•°æ®

å“åº”ç”¨æˆ·æ“ä½œ, æ›´æ–°ç»„ä»¶ç•Œé¢

- ç»‘å®šäº‹ä»¶ç›‘å¬, å¹¶å¤„ç†

- æ›´æ–° state

## å››ã€react ajax

### 4.1 ç†è§£

å‰ç½®è¯´æ˜

- React æœ¬èº«åªå…³æ³¨äºç•Œé¢ï¼Œå¹¶ä¸åŒ…å«å‘é€ ajax è¯·æ±‚çš„ä»£ç 

- å‰ç«¯åº”ç”¨éœ€è¦é€šè¿‡ ajax è¯·æ±‚ä¸åå°è¿›è¡Œäº¤äº’ï¼ˆjson æ•°æ®ï¼‰

- react åº”ç”¨ä¸­éœ€è¦é›†æˆç¬¬ä¸‰æ–¹ ajax åº“ï¼ˆæˆ–è‡ªå·±å°è£…ï¼‰

å¸¸ç”¨çš„ ajax è¯·æ±‚åº“

- jQueryï¼šæ¯”è¾ƒé‡ï¼Œå¦‚æœéœ€è¦å¦å¤–å¼•å…¥ä¸å»ºè®®ä½¿ç”¨

- **axios**ï¼šè½»é‡çº§ï¼Œå»ºè®®ä½¿ç”¨

  a. å°è£… XmlHttpRequest å¯¹è±¡çš„ ajax

  b. promise é£æ ¼

  c. å¯ä»¥ç”¨åœ¨æµè§ˆå™¨ç«¯å’Œ node æœåŠ¡å™¨ç«¯

- fetchï¼šåŸç”Ÿå‡½æ•°ï¼Œä½†è€ç‰ˆæœ¬æµè§ˆå™¨ä¸æ”¯æŒ

  a. ä¸å†ä½¿ç”¨ XmlHttpRequest å¯¹è±¡æäº¤ ajax è¯·æ±‚

  b. ä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œå¯ä»¥å¼•å…¥å…¼å®¹åº“ fetch.js

æ•ˆæœ

```md
éœ€æ±‚ï¼š

1. ç•Œé¢æ•ˆæœå¦‚ä¸‹
2. æ ¹æ®æŒ‡å®šçš„å…³é”®å­—åœ¨ GitHub ä¸Šæœç´¢åŒ¹é…çš„æœ€å—å…³æ³¨çš„åº“
3. æ˜¾ç¤ºåº“åï¼Œç‚¹å‡»é“¾æ¥æŸ¥çœ‹åº“

æµ‹è¯•æ¥å£: https://api.github.com/search/repositories?q=r&sort=stars
```

![ajax](https://cdn.wallleap.cn/img/pic/illustration/ajax.gif)

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>11_ajax</title>
  <style>
    h2{
      text-align: center;
      margin-top: 200px;
    }
  </style>
</head>
<body>
<div id="example"></div>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>

<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.js"></script>

<script type="text/babel">
  /*
  éœ€æ±‚:
    1. ç•Œé¢æ•ˆæœå¦‚ä¸‹
    2. æ ¹æ®æŒ‡å®šçš„å…³é”®å­—åœ¨githubä¸Šæœç´¢åŒ¹é…çš„æœ€å—å…³æ³¨çš„åº“
    3. æ˜¾ç¤ºåº“å, ç‚¹å‡»é“¾æ¥æŸ¥çœ‹åº“
    4. æµ‹è¯•æ¥å£: https://api.github.com/search/repositories?q=r&sort=stars
  */
  class MostStarRepo extends React.Component{
    state = {
      repoName: '',
      repoUrl: ''
    }

    componentDidMount(){
      // ä½¿ç”¨axioså‘é€å¼‚æ­¥çš„ajaxè¯·æ±‚
      const url = `https://api.github.com/search/repositories?q=re&sort=stars`
      axios.get(url)
          .then(response => {
            const result = response.data
            // console.log(response)
            // å¾—åˆ°æ•°æ®
            const {name, html_url} = result.items[0]
            // æ›´æ–°çŠ¶æ€
            this.setState({repoName:name, repoUrl: html_url})
          })
          .catch((error) => {
            alert(error.message)
          })
      // ä½¿ç”¨fetchå‘é€å¼‚æ­¥çš„ajaxè¯·æ±‚
      /*fetch(url)
          .then(response => {
            return response.json()
          })
          .then(data => {
            // å¾—åˆ°æ•°æ®
            const {name, html_url} = data.items[0]
            // æ›´æ–°çŠ¶æ€
            this.setState({repoName:name, repoUrl: html_url})
          })
      */
    }

    render(){
      const {repoName, repoUrl} = this.state
      if(!repoName){
        return(
          <h2>LOADING...</h2>
        )
      }else{
        return(
          <h2>Most star repo is <a href={repoUrl}>{repoName}</a></h2>
        )
      }
      
    }
  }
  ReactDOM.render(<MostStarRepo />, document.getElementById('example'))
</script>
</body>
</html>
```

### 4.2 axios

æ–‡æ¡£ï¼š

https://github.com/axios/axios

ç›¸å…³ APIï¼š

GET è¯·æ±‚

```javascript
axios.get('/user?ID=12345')
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });

axios.get('/user', {
    params: {
      ID: 12345
    }
  })
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });
```

POST è¯·æ±‚

```javascript
axios.post('/user', {
  firstName: 'Fred',
  lastName: 'Flintstone'
})
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });
```

### 4.3 Fetch

æ–‡æ¡£

- <https://github.github.io/fetch/>

- <https://segmentfault.com/a/1190000003810652>

ç›¸å…³ API

GET è¯·æ±‚

```javascript
fetch(url).then(function(response) {
    return response.json()
  }).then(function(data) {
    console.log(data)
  }).catch(function(e) {
    console.log(e)
  });
```

POST è¯·æ±‚

```javascript
fetch(url, {
    method: "POST",
    body: JSON.stringify(data),
  }).then(function(data) {
    console.log(data)
  }).catch(function(e) {
    console.log(e)
  })
```

### 4.4 demoï¼šgithub users

æ•ˆæœ

![demo_users](https://cdn.wallleap.cn/img/pic/illustration/demo_users.gif)

æ‹†åˆ†ç»„ä»¶

![æ‹†åˆ†ç»„ä»¶](https://cdn.wallleap.cn/img/pic/illustration/image-20200711091558440.png)

```md
App

â€‹       * state: searchName/string

  Search

â€‹      * props: setSearchName/func

  List

â€‹      * props: searchName/string

â€‹      * state: firstView/bool, loading/bool, users/array, errMsg/string
```

ç¼–å†™é™æ€ç»„ä»¶ã€ç¼–å†™åŠ¨æ€ç»„ä»¶

componentWillReceiveProps(nextProps)ï¼šç›‘è§†æ¥æ”¶åˆ°æ–°çš„ propsï¼Œå‘é€ ajax

ä½¿ç”¨ axios åº“å‘é€ ajax è¯·æ±‚

`public/index.html`

```html
<div id="root"></div>
```

`src/index.js`

```javascript
import React from 'react'
import { render } from 'react-dom'

import App from './components/app'
import './index.css'

render(<App />, document.getElementById('root'))
```

`src/index.css`

```css
.album {
  min-height: 50rem; /* Can be removed; just added for demo purposes */
  padding-top: 3rem;
  padding-bottom: 3rem;
  background-color: #f7f7f7;
}

.card {
  float: left;
  width: 33.333%;
  padding: .75rem;
  margin-bottom: 2rem;
  border: 1px solid #efefef;
  text-align: center;
}

.card > img {
  margin-bottom: .75rem;
  border-radius: 100px;
}

.card-text {
  font-size: 85%;
}
```

`src/components/app.jsx`

```jsx
import React from 'react'
import Search from './search'
import UserList from './user-list'

export default class App extends React.Component {

  state = {
    searchName: ''
  }

  refreshName = (searchName) => this.setState({searchName})

  render() {
    return (
      <div className="container">
        <section className="jumbotron">
          <h3 className="jumbotron-heading">Search Github Users</h3>
          <Search refreshName={this.refreshName}/>
        </section>
        <UserList searchName={this.state.searchName}/>
      </div>
    )
  }
}
```

`src/components/search.jsx`

```jsx
/**
 * ä¸Šéƒ¨çš„æœç´¢æ¨¡å—
*/
import React, {Component} from 'react'
import PropTypes from 'prop-types'

class Search extends Component {

  static propTypes = {
    refreshName: PropTypes.func.isRequired
  }

  search = () => {
    var name = this.nameInput.value
    this.props.refreshName(name)
  }

  render() {
    return (
      <div>
        <input type="text" placeholder="enter the name you search"
              ref={(input => this.nameInput = input)}/>
        <button onClick={this.search}>Search</button>
      </div>
    )
  }
}

export default Search
```

`src/components/user-list.jsx`

```jsx
/**
 * ä¸‹éƒ¨çš„ç”¨æˆ·åˆ—è¡¨æ¨¡å—
*/
import React from 'react'
import PropTypes from 'prop-types'
import axios from 'axios'
// npm install axios --save 

class UserList extends React.Component {

  static propTypes = {
    searchName: PropTypes.string.isRequired
  }

  state = {
    firstView: true,
    loading: false,
    users: null,
    error: null
  }

  async componentWillReceiveProps(nextProps)  {
    let searchName = nextProps.searchName
    console.log('å‘é€ajaxè¯·æ±‚', searchName)
    const url = `https://api.github.com/search/users?q=${searchName}`
    this.setState({ firstView: false, loading: true })

    // ä½¿ç”¨axiosåº“
    axios.get(url)
      .then((response) => {
        console.log(response)
        this.setState({ loading: false, users: response.data.items })
      })
      .catch((error)=>{
        // debugger
        console.log('error', error.response.data.message, error.message)
        this.setState({ loading: false, error: error.message })
      })

    try {
      const result = await axios.get(url)
      this.setState({ loading: false, users: result.data.items })
    } catch(err) {
      // debugger
      console.log('----', err.message)
    }
  }

  render () {

    if (this.state.firstView) {
      return <h2>Enter name to search</h2>
    } else if (this.state.loading) {
      return <h2>Loading result...</h2>
    } else if (this.state.error) {
      return <h2>{this.state.error}</h2>
    } else {
      return (
        <div className="row">
          {
            this.state.users.map((user) => (
              <div className="card" key={user.html_url}>
                <a href={user.html_url} target="_blank">
                  <img src={user.avatar_url} style={{width: '100px'}} alt='user'/>
                </a>
                <p className="card-text">{user.login}</p>
              </div>
            ))
          }
        </div>
      )
    }
  }
}

export default UserList
```

## äº”ã€å‡ ä¸ªé‡è¦æŠ€æœ¯æ€»ç»“

### 5.1 ç»„ä»¶é—´é€šä¿¡

#### 5.1.1 æ–¹å¼ä¸€ï¼šé€šè¿‡ props ä¼ é€’

- å…±åŒçš„æ•°æ®æ”¾åœ¨çˆ¶ç»„ä»¶ä¸Šï¼Œç‰¹æœ‰çš„æ•°æ®æ”¾åœ¨è‡ªå·±ç»„ä»¶å†…éƒ¨ï¼ˆstateï¼‰

- é€šè¿‡ props å¯ä»¥ä¼ é€’ä¸€èˆ¬æ•°æ®å’Œå‡½æ•°æ•°æ®ï¼Œåªèƒ½ä¸€å±‚ä¸€å±‚ä¼ é€’

- ä¸€èˆ¬æ•°æ®-->çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ç»™å­ç»„ä»¶-->å­ç»„ä»¶è¯»å–æ•°æ®

- å‡½æ•°æ•°æ®-->å­ç»„ä»¶ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶-->å­ç»„ä»¶è°ƒç”¨å‡½æ•°

çˆ¶ç»„ä»¶ä¼ åˆ°å­™ç»„ä»¶ã€å…„å¼Ÿç»„ä»¶ä¹‹é—´ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œç»è¿‡å­ç»„ä»¶ã€æœåŠ¡å™¨ä¼ é€’

#### 5.1.2 æ–¹å¼äºŒï¼šä½¿ç”¨æ¶ˆæ¯è®¢é˜…ï¼ˆsubscribeï¼‰-å‘å¸ƒï¼ˆpublishï¼‰æœºåˆ¶

å·¥å…·åº“: PubSubJS

ä¸‹è½½: `npm install pubsub-js --save`

ä½¿ç”¨:

```javascript
import PubSub from 'pubsub-js' //å¼•å…¥
PubSub.publish('delete', data) //å‘å¸ƒæ¶ˆæ¯
// æ¶ˆæ¯åï¼Œæ¶ˆæ¯
PubSub.subscribe('delete', function(msg, data){ }); //è®¢é˜…
// æ¶ˆæ¯åï¼Œå›è°ƒå‡½æ•°
```

ä»¥ä¸Šä¸€ä¸ªç”¨æˆ·æœç´¢çš„ demo ä¸ºä¾‹ï¼Œsearch å’Œ userlist(main) ä¹‹é—´éœ€è¦é€šä¿¡ï¼Œå®ƒä»¬æ˜¯å…„å¼Ÿç»„ä»¶

åœ¨è¿™é‡Œæ˜¯é€šè¿‡çˆ¶ç»„ä»¶ï¼Œåˆ©ç”¨ props è¿›è¡Œé€šä¿¡

![props-search](https://cdn.wallleap.cn/img/pic/illustration/image-20200714161016458.png)

è¿™æ˜¯ä»¥å‰çš„ app.ejs

![app.ejs](https://cdn.wallleap.cn/img/pic/illustration/image-20200714161302225.png)

ç°åœ¨ä¸é€šè¿‡çˆ¶ç»„ä»¶æ¥é€šä¿¡

`src/components/app.ejs`

```ejs
import React from 'react'
import Search from './search'
import UserList from './user-list'

export default class App extends React.Component {

  render() {
    return (
      <div className="container">
        <section className="jumbotron">
          <h3 className="jumbotron-heading">Search Github Users</h3>
          <Search/>
        </section>
        <UserList/>
      </div>
    )
  }

}
```

`src/components/search.ejs`

```ejs
/**
* ä¸Šéƒ¨çš„æœç´¢æ¨¡å—
*/
import React, {Component} from 'react'
import PropTypes from 'prop-types'
import PubSub from 'pubsub-js' //å¼•å…¥
class Search extends Component {
  search = () => {
    var searchName = this.nameInput.value
    if(searchName){
      // æœç´¢
      // å‘å¸ƒæ¶ˆæ¯ search
PubSub.publish('search', searchName)
    }
  }
  render() {
    return (
      <div>
        <input type="text" placeholder="enter the name you search"
              ref={(input => this.nameInput = input)}/>
        <input type="submit" value="Search" onClick={this.search} />
      </div>
    )
  }
}
export default Search
```

`src/components/user-list.ejs`

```ejs
/**
* ä¸‹éƒ¨çš„ç”¨æˆ·åˆ—è¡¨æ¨¡å—
*/
import React from 'react'
import PropTypes from 'prop-types'
import axios from 'axios'
import PubSub from 'pubsub-js' //å¼•å…¥
class UserList extends React.Component {
  static propTypes = {
    searchName: PropTypes.string.isRequired
  }
  state = {
    firstView: true,
    loading: false,
    users: null,
    error: null
  }
  componentDidMount(){
    // è®¢é˜…æ¶ˆæ¯ search
  PubSub.subscribe('search', (msg, searchName) => { // æŒ‡å®šäº†æ–°çš„nameï¼Œéœ€è¦è¯·æ±‚    
      this.setState({ firstView: false, loading: true })
      // ä½¿ç”¨axiosåº“
      const url = `https://api.github.com/search/users?q=${searchName}`
      axios.get(url)
        .then((response) => {
    console.log(response)
          this.setState({ loading: false, users: response.data.items })
        })
        .catch((error)=>{
          // debugger       console.log('error', error.response.data.message, error.message)
          this.setState({ loading: false, error: error.message })
        })
      try {
        const result = axios.get(url)
        this.setState({ loading: false, users: result.data.items })
      } catch(err) {
        // debugger
        console.log('----', err.message)
      }
    })
  }
  render () {
    if (this.state.firstView) {
      return <h2>Enter name to search</h2>
    } else if (this.state.loading) {
      return <h2>Loading result...</h2>
    } else if (this.state.error) {
      return <h2>{this.state.error}</h2>
    } else {
      return (
        <div className="row">
          {         this.state.users.map((user) => (
              <div className="card" key={user.html_url}>
                <a href={user.html_url} target="_blank">
                  <img src={user.avatar_url} style={{width: '100px'}} alt='user'/>
                </a>
                <p className="card-text">{user.login}</p>
              </div>
            ))
          }
        </div>
      )
    }
  }
}
export default UserList
```

å†ä»¥ä¹‹å‰çš„è¯„è®ºçš„ä¸ºä¾‹

App.ejs ä¸­æœ‰ä¸ªåˆ é™¤è¯„è®ºçš„å‡½æ•°ï¼Œä¼ ç»™äº† List ç»„ä»¶(å¹¶æ²¡æœ‰ç”¨åˆ°)ï¼Œæ¥ç€ä¼ ç»™ Item

```jsx
delete={this.delete}
```

#### 5.1.3 æ–¹å¼ä¸‰ï¼šredux

redux æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œåé¢ä¸“é—¨è®²è§£

### 5.2 äº‹ä»¶ç›‘å¬ç†è§£

#### 5.2.1 åŸç”Ÿ DOM äº‹ä»¶

- ç»‘å®šäº‹ä»¶ç›‘å¬

  - äº‹ä»¶åï¼ˆç±»å‹ï¼‰ï¼šåªæœ‰æœ‰é™çš„å‡ ä¸ªï¼Œä¸èƒ½éšä¾¿å†™

  - å›è°ƒå‡½æ•°

- è§¦å‘äº‹ä»¶

  - ç”¨æˆ·æ“ä½œç•Œé¢

  - äº‹ä»¶åï¼ˆç±»å‹ï¼‰

  - æ•°æ®

#### 5.2.2 è‡ªå®šä¹‰äº‹ä»¶ï¼ˆæ¶ˆæ¯æœºåˆ¶ï¼‰

- ç»‘å®šäº‹ä»¶ç›‘å¬

  - äº‹ä»¶åï¼ˆç±»å‹ï¼‰ï¼šä»»æ„

  - å›è°ƒå‡½æ•°ï¼šé€šè¿‡å½¢å‚æ¥æ”¶æ•°æ®ï¼Œåœ¨å‡½æ•°ä½“å¤„ç†äº‹ä»¶

- è§¦å‘äº‹ä»¶ï¼ˆç¼–ç ï¼‰

  - äº‹ä»¶åï¼ˆç±»å‹ï¼‰ï¼šä¸ç»‘å®šçš„äº‹ä»¶ç›‘å¬çš„äº‹ä»¶åä¸€è‡´

  - æ•°æ®ï¼šä¼šè‡ªåŠ¨ä¼ é€’ç»™å›è°ƒå‡½æ•°

### 5.3 ES 6 å¸¸ç”¨æ–°è¯­æ³•

- å®šä¹‰å¸¸é‡/å˜é‡ï¼š`const/let`

- è§£æ„èµ‹å€¼ï¼š`let {a, b} = this.props`ã€`import {aa} from 'xxx'`

- å¯¹è±¡çš„ç®€æ´è¡¨è¾¾ï¼š`{a, b}`

- ç®­å¤´å‡½æ•°ï¼š

  - å¸¸ç”¨åœºæ™¯

    - ç»„ä»¶çš„è‡ªå®šä¹‰æ–¹æ³•ï¼š`xxx = () => {}`

    - å‚æ•°åŒ¿åå‡½æ•°

  - ä¼˜ç‚¹ï¼š

    - ç®€æ´

    - æ²¡æœ‰è‡ªå·±çš„ thisï¼Œä½¿ç”¨å¼•ç”¨ this æŸ¥æ‰¾çš„æ˜¯å¤–éƒ¨ this

- æ‰©å±•(ä¸‰ç‚¹)è¿ç®—ç¬¦ï¼šæ‹†è§£å¯¹è±¡/æ•°ç»„ `(const MyProps = {}, <Xxx {...MyProps}>)`

- ç±»ï¼š`class/extends/constructor/super`

- ES 6 æ¨¡å—åŒ–ï¼š`export default | import`

## å…­ã€react-router 4

### 6.1 ç›¸å…³ç†è§£

#### 6.1.1 react-router çš„ç†è§£

- react çš„ä¸€ä¸ªæ’ä»¶åº“ï¼ˆä¾èµ–/åŸºäº Reactï¼‰

- ä¸“é—¨ç”¨æ¥å®ç°ä¸€ä¸ª SPA åº”ç”¨

- åŸºäº react çš„é¡¹ç›®åŸºæœ¬éƒ½ä¼šç”¨åˆ°æ­¤åº“

#### 6.1.2 SPAçš„ç†è§£

- å•é¡µ Web åº”ç”¨ï¼ˆsingle page web application, SPAï¼‰

- æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªå®Œæ•´çš„é¡µé¢

- ç‚¹å‡»é¡µé¢ä¸­çš„é“¾æ¥ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œæœ¬èº«ä¹Ÿä¸ä¼šå‘æœåŠ¡å™¨å‘è¯·æ±‚

- å½“ç‚¹å‡»è·¯ç”±é“¾æ¥æ—¶ï¼Œåªä¼šåšé¡µé¢çš„**å±€éƒ¨æ›´æ–°**

- æ•°æ®éƒ½éœ€è¦é€šè¿‡ **ajax è¯·æ±‚**è·å–ï¼Œå¹¶åœ¨å‰ç«¯**å¼‚æ­¥å±•ç°**

#### 6.1.3 è·¯ç”±çš„ç†è§£

- ä»€ä¹ˆæ˜¯è·¯ç”±?

  - ä¸€ä¸ªè·¯ç”±å°±æ˜¯ä¸€ä¸ª**æ˜ å°„å…³ç³»(key: value)**

  - key ä¸º**è·¯ç”±è·¯å¾„ï¼ˆpathï¼‰**ï¼Œvalue å¯èƒ½æ˜¯ function(åå°è·¯ç”±)/**componentï¼ˆå‰å°è·¯ç”±ï¼‰**

- è·¯ç”±åˆ†ç±»

  - åå°è·¯ç”±ï¼šnode æœåŠ¡å™¨ç«¯è·¯ç”±value æ˜¯ functionï¼Œç”¨æ¥å¤„ç†å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªå“åº”æ•°æ®

  - å‰å°è·¯ç”±ï¼šæµè§ˆå™¨ç«¯è·¯ç”±ï¼Œvalue æ˜¯ componentï¼Œå½“è¯·æ±‚çš„æ˜¯è·¯ç”± path æ—¶ï¼Œæµè§ˆå™¨ç«¯å‰æ²¡æœ‰å‘é€ http è¯·æ±‚ï¼Œä½†ç•Œé¢ä¼šæ›´æ–°æ˜¾ç¤ºå¯¹åº”çš„ç»„ä»¶

- åå°è·¯ç”±

  - æ³¨å†Œè·¯ç”±ï¼š`router.get(path, function(req, res))`

  - å½“ node æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„æ‰¾åˆ°åŒ¹é…çš„è·¯ç”±ï¼Œè°ƒç”¨è·¯ç”±ä¸­çš„å‡½æ•°æ¥å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”æ•°æ®

- å‰ç«¯è·¯ç”±

  - æ³¨å†Œè·¯ç”±ï¼š`<Route path="/about" component={About}>`

  - å½“æµè§ˆå™¨çš„ **hash** å˜ä¸º `#about` æ—¶ï¼Œå½“å‰è·¯ç”±ç»„ä»¶å°±ä¼šå˜ä¸º About ç»„ä»¶

#### 6.1.4 å‰ç«¯è·¯ç”±çš„å®ç°

åº•å±‚å®ç°ï¼š

history åº“

- ç½‘å€ï¼š<https://github.com/ReactTraining/history>

- ç®¡ç†æµè§ˆå™¨ä¼šè¯å†å²ï¼ˆhistoryï¼‰çš„å·¥å…·åº“

- åŒ…è£…çš„æ˜¯åŸç”Ÿ BOM ä¸­ `window.history` å’Œ `window.location.hash`

- history API

  - `History.createBrowserHistory()`ï¼šå¾—åˆ°å°è£… `window.history` çš„ç®¡ç†å¯¹è±¡

  - `History.createHashHistory()`ï¼šå¾—åˆ°å°è£… `window.location.hash` çš„ç®¡ç†å¯¹è±¡

  - `history.push()`ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„å†å²è®°å½•

  - `history.replace()`ï¼šç”¨ä¸€ä¸ªæ–°çš„å†å²è®°å½•æ›¿æ¢å½“å‰çš„è®°å½•

  - `history.goBack()`ï¼šå›é€€åˆ°ä¸Šä¸€ä¸ªå†å²è®°å½•

  - `history.goForward()`ï¼šå‰è¿›åˆ°ä¸‹ä¸€ä¸ªå†å²è®°å½•

  - `history.listen(function(location){})`ï¼šç›‘è§†å†å²è®°å½•çš„å˜åŒ–

æµ‹è¯•ï¼š

![history-æ–¹å¼1](https://cdn.wallleap.cn/img/pic/illustration/history-æ–¹å¼1.gif)

![history-æ–¹å¼2](https://cdn.wallleap.cn/img/pic/illustration/history-æ–¹å¼2.gif)

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>history test</title>
</head>
<body>

  <p><input type="text"></p>
  <a href="/test1" onclick="return push('/test1')">test1</a><br><br>
  <button onClick="push('/test2')">push test2</button><br><br>
  <button onClick="back()">å›é€€</button><br><br>
  <button onClick="forward()">å‰è¿›</button><br><br>
  <button onClick="replace('/test3')">replace test3</button><br><br>

  <script type="text/javascript" src="https://cdn.bootcss.com/history/4.7.2/history.js"></script>
  <script type="text/javascript">
    let history = History.createBrowserHistory() // æ–¹å¼ä¸€
    history = History.createHashHistory() // æ–¹å¼äºŒ
    // console.log(history)

    function push (to) {
      history.push(to)
      return false
    } // å¯ä»¥è¿”å›

    function back() {
      history.goBack()
    }

    function forward() {
      history.goForward()
    }

    function replace (to) {
      history.replace(to)
    } // ä¸èƒ½è¿”å›

    history.listen((location) => {
      console.log('è¯·æ±‚è·¯ç”±è·¯å¾„å˜åŒ–äº†', location)
    })
  </script>
</body>
</html>
```

### 6.2 react-router ç›¸å…³ API

[react_router](https://reactrouter.com/)

![react-router](https://cdn.wallleap.cn/img/pic/illustration/image-20200714181151269.png)

[web](https://reactrouter.com/web/guides/quick-start)

#### 6.2.1 ç»„ä»¶

- `<BrowserRouter>`ï¼šBrowserRouter æ˜¯ react è·¯ç”±çš„å®¹å™¨

- `<HashRouter>`ï¼šè¿™ä¸ªæ˜¯ç”¨æ¥å…¼å®¹è€æµè§ˆå™¨çš„

- `<Route>`ï¼šRoute çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ¸²æŸ“è·¯ç”±åŒ¹é…çš„ç»„ä»¶ã€‚è·¯ç”±æ¸²æŸ“æœ‰ä¸‰ç§æ–¹å¼ï¼Œæ¯ä¸€ç§æ–¹å¼éƒ½å¯ä»¥ä¼ é€’ match,location,history å¯¹è±¡

- `<Redirect>`ï¼šè·¯ç”±é‡å®šå‘

- `<Link>`ï¼šLink çš„ä½œç”¨å’Œ a æ ‡ç­¾ç±»ä¼¼

- `<NavLink>`ï¼šNavLink å’Œ Link ä¸€æ ·æœ€ç»ˆéƒ½æ˜¯æ¸²æŸ“æˆ a æ ‡ç­¾ï¼ŒNavLink å¯ä»¥ç»™è¿™ä¸ª a æ ‡ç­¾æ·»åŠ é¢å¤–çš„å±æ€§

- `<Switch>`ï¼šSwitch ç»„ä»¶å†…éƒ¨å¯ä»¥æ˜¯ Route æˆ–è€… Redirectï¼Œåªä¼šæ¸²æŸ“ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ 

#### 6.2.2 å…¶å®ƒ

- **`history` å¯¹è±¡**ï¼šè¿™é‡Œçš„ history å¯¹è±¡æ˜¯ä½¿ç”¨ history æ’ä»¶ç”Ÿæˆçš„ï¼Œ<http://www.cnblogs.com/ye-hcj/p/7741742.html> å·²ç»è¯¦ç»†è®²è¿‡äº†

  - è®°ä½ä¸€ç‚¹ï¼Œåœ¨ä½¿ç”¨ location åšå¯¹æ¯”çš„ä½¿ç”¨ï¼Œé€šè¿‡ history è®¿é—®çš„ location æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæœ€å¥½é€šè¿‡ Route è®¿é—® location

- `match`å¯¹è±¡ï¼šmatch å¯¹è±¡è¡¨ç¤ºå½“å‰çš„è·¯ç”±åœ°å€æ˜¯æ€ä¹ˆè·³è½¬è¿‡æ¥çš„

- `withRouter` å‡½æ•°ï¼šå½“ä¸€ä¸ªéè·¯ç”±ç»„ä»¶ä¹Ÿæƒ³è®¿é—®åˆ°å½“å‰è·¯ç”±çš„ match,location,history å¯¹è±¡ï¼Œé‚£ä¹ˆ withRouter å°†æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©

### 6.3 åŸºæœ¬è·¯ç”±ä½¿ç”¨

![react-router demo](https://cdn.wallleap.cn/img/pic/illustration/react-router%20demo1%20(3).gif)

å¹¶æ²¡æœ‰åˆ·æ–°é¡µé¢

å‡†å¤‡

ä¸‹è½½ react-routerï¼š`npm install --save react-router@4`

æˆ‘ä»¬åªéœ€è¦webç‰ˆæœ¬ï¼š`npm install --save react-router-dom`

ç”±äºä½¿ç”¨åˆ°äº† BootStrapï¼Œå› æ­¤åœ¨ index.html ä¸­å¼•å…¥ bootstrap.cssï¼š `<link rel="stylesheet" href="/css/bootstrap.css">`

`public/index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>React-router</title>
    <link rel="stylesheet" href="/css/bootstrap.css">
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
  </body>
</html>
```

ä¸€èˆ¬ä¼šå°†è·¯ç”±ç»„ä»¶å’Œéè·¯ç”±ç»„ä»¶åˆ†å¼€å†™

`pages`/`views` å­˜æ”¾è·¯ç”±ç»„ä»¶

`components` å­˜æ”¾å…¶ä»–ç»„ä»¶

è·¯ç”±ç»„ä»¶ï¼š`views/about.jsx`

```jsx
import React,{Component} from 'react'
export default class About extends Component{
  render(){
    return(
      <div>Aboutç»„ä»¶å†…å®¹</div>
    )
  }
}
```

è·¯ç”±ç»„ä»¶ï¼š`views/home.jsx`

```jsx
import React, {Component} from 'react'

export default class Home extends Component{
  render(){
    return (
    <div>Homeç»„ä»¶å†…å®¹</div>
    )
  }
}
```

åŒ…è£… NavLink ç»„ä»¶ï¼š`components/my-nav-link.jsx`ï¼Œç”±äºæ¯ä¸ª NavLink éƒ½éœ€è¦è‡ªå®šä¹‰ active æ ·å¼ï¼ˆåŠ å…¥å±æ€§ activeClassNameï¼‰ï¼Œå› æ­¤æå‡ºæ¥

```jsx
import React, {Component} from 'react'
import {NavLink} from 'react-router-dom'

export default class MyNavLink extends Component {
  render(){
    // åˆ©ç”¨this.propsä¸‰ç‚¹è¿ç®—ç¬¦æ¥å—æ‰€æœ‰çš„å±æ€§
    return(
      <NavLink {...this.props} activeClassName='activeClass'/>
    )
  }
}
```

åº”ç”¨ç»„ä»¶ï¼š`components/app.jsx`

```jsx
import React from 'react'
import {NavLink, Route, Switch, Redirect} from 'react-router-dom'
import MyNavLink from './my-nav-link'
import About from '../views/about'
import Home from '../views/home'

export default class App extends React.Component {

  render() {
    return (
      <div>
        <div className="row">
          <div className="col-xs-offset-2 col-xs-8">
            <div className="page-header">
              <h2>React Router Demo</h2>
            </div>
          </div>
        </div>

        <div className="row">
          <div className="col-xs-2 col-xs-offset-2">
            <div className="list-group">
              {/*å¯¼èˆªè·¯ç”±é“¾æ¥ï¼Œä¸èƒ½ä½¿ç”¨aæ ‡ç­¾ï¼ŒtoæŒ‡å‘çš„path*/}
              <MyNavLink className="list-group-item" to='/about'>About</MyNavLink>
              <MyNavLink className="list-group-item" to='/home'>Home</MyNavLink>
            </div>
          </div>
          <div className="col-xs-6">
            <div className="panel">
              <div className="panel-body">
                {/*å¯åˆ‡æ¢çš„è·¯ç”±ç»„ä»¶ï¼Œä½¿ç”¨switchåªæœ‰åŒ¹é…æ‰æ˜¾ç¤ºï¼Œrouteçš„pathå¯¹åº”ä¸Šæ–¹çš„toã€componentå¯¹åº”è·¯ç”±ç»„ä»¶ï¼ŒRedirectè‡ªåŠ¨é‡å®šå‘åˆ°aboutã€é»˜è®¤åˆ°aboutç»„ä»¶*/}
                <Switch>
                  <Route path='/about' component={About}/>
                  <Route path='/home' component={Home}/>
                  <Redirect to='/about'/>
                </Switch>
              </div>
            </div>
          </div>
        </div>
      </div>
    )
  }
}
```

è‡ªå®šä¹‰æ ·å¼ï¼š`index.css`

```css
activeClass {
  color: red !important;
}
```

å…¥å£JSï¼š`index.js`

```javascript
import React from 'react'
//import ReactDOM from 'react-dom'
import {render} from 'react-dom'
import {BrowserRouter, HashRouter} from 'react-router-dom'
import App from './components/app'

import './index.css'

// ReactDOM.render(
render(
  (
    <BrowserRouter>
      <App/>
    </BrowserRouter>
    /* ç»„ä»¶éœ€è¦ç”¨è·¯ç”±å™¨ç»„ä»¶åŒ…å«èµ·æ¥ï¼Œä¸¤è€…ä»»é€‰ä¸€ä¸ª */
    /*<HashRouter>
      <App />
    </HashRouter>*/
  ),
  document.getElementById('root')
)
```

æ€»ç»“ï¼šå¦‚ä½•ç¼–å†™è·¯ç”±æ•ˆæœï¼Ÿ

1. ç¼–å†™è·¯ç”±ç»„ä»¶
2. åœ¨çˆ¶è·¯ç”±ç»„ä»¶ä¸­æŒ‡å®š
   - è·¯ç”±è¿æ¥ï¼š`<NavLink></NavLink>`
   - è·¯ç”±ï¼š`<Route></Route>`

### 6.4 åµŒå¥—è·¯ç”±ä½¿ç”¨

åµŒå¥—è·¯ç”±â€”â€”è·¯ç”±ç»„ä»¶ä¸­çš„è·¯ç”±

![react-router demo2](https://cdn.wallleap.cn/img/pic/illustration/react-router-demo2.gif)

äºŒçº§è·¯ç”±ç»„ä»¶ï¼š`views/news.jsx`

```jsx
import React from 'react'

export default class News extends React.Component {
  state = {
    newsArr: ['news001', 'news002', 'news003']
  }

  render () {
    return (
      <div>
        <ul>
          {
            this.state.newsArr.map((news, index) => <li key={index}>{news}</li>)
          }
        </ul>
      </div>
    )
  }
}
```

äºŒçº§è·¯ç”±ç»„ä»¶ï¼š`views/message.jsx`

```jsx
import React from 'react'
import {Link, Route} from 'react-router-dom'

export default class Message extends React.Component {
  state = {
    messages: []
  }

  componentDidMount () {
    // æ¨¡æ‹Ÿå‘é€ajaxè¯·æ±‚
    setTimeout(() => {
      const data = [
        {id: 1, title: 'Message001'},
        {id: 3, title: 'Message003'},
        {id: 6, title: 'Message006'},
      ]
      this.setState({
        messages: data
      })
    }, 1000)
  }

  render () {
    const path = this.props.match.path

    return (
      <div>
        <ul>
          {
            this.state.messages.map((m, index) => {
              return (
                <li key={index}>
                  <a href='???'>{m.title}</a>
                </li>
              )
            })
          }
        </ul>
      </div>
    )
  }
}
```

ä¸€çº§è·¯ç”±ç»„ä»¶ï¼š`views/home.jsx`

```jsx
import React, {Component} from 'react'
import {Switch, Route, Redirect} from 'react-router-dom'
import MyNavLink from '../components/my-nav-link'
import News from './news'
import Message from './message'

export default class Home extends Component{
  render(){
    return (
      <div>
        <h2>Homeç»„ä»¶å†…å®¹</h2>
        <div>
          <ul className="nav nav-tabs">
            <li>
              <MyNavLink to='/home/news'>News</MyNavLink>
            </li>
            <li>
              <MyNavLink to="/home/message">Message</MyNavLink>
            </li>
          </ul>
          <Switch>
            <Route path='/home/news' component={News} />
            <Route path='/home/message' component={Message} />
            <Redirect to='/home/news'/>
          </Switch>
        </div>
      </div>
    )
  }
}
```

### 6.5 å‘è·¯ç”±ç»„ä»¶ä¼ é€’å‚æ•°æ•°æ®

ä¼ é€’çš„æ˜¯ id å€¼

![react-router demo3 (2)](https://cdn.wallleap.cn/img/pic/illustration/react-router-demo3.gif)

ä¸‰çº§è·¯ç”±ç»„ä»¶ï¼š`views/message-detail.jsx`

```jsx
import React from 'react'

const messageDetails = [
  {id: 1, title: 'Message001', content: 'ä¸­å›½ï¼Œä½ æ˜¯æœ€æ£’çš„'},
  {id: 3, title: 'Message003', content: 'å¯¹çš„ï¼Œæ²¡é”™ï¼Œéå¸¸èµæˆæ¥¼ä¸Š'},
  {id: 6, title: 'Message006', content: 'æˆ‘ä¹Ÿèµæˆ'},
]

// å‡½æ•°çš„ç»„ä»¶
export default function MessageDetail(props) {

  const id = props.match.params.id
  const md = messageDetails.find(md => md.id===id*1)

  return (
    <ul>
      <li>ID: {md.id}</li>
      <li>TITLE: {md.title}</li>
      <li>CONTENT: {md.content}</li>
    </ul>
  )
}
```

äºŒçº§è·¯ç”±ç»„ä»¶ï¼š`views/message.jsx`

```jsx
import React from 'react'
import {Link, Route} from 'react-router-dom'
import MessageDetail from "./message-detail"

export default class Message extends React.Component {
  state = {
    messages: []
  }

  componentDidMount () {
    // æ¨¡æ‹Ÿå‘é€ajaxè¯·æ±‚
    setTimeout(() => {
      const data = [
        {id: 1, title: 'Message001'},
        {id: 3, title: 'Message003'},
        {id: 6, title: 'Message006'},
      ]
      this.setState({
        messages: data
      })
    }, 1000)
  }

  render () {
    const path = this.props.match.path

    return (
      <div>
        <ul>
          {
            this.state.messages.map((m, index) => {
              return (
                <li key={index}>
                  <Link to={`${path}/${m.id}`}>{m.title}</Link>
                </li>
              )
            })
          }
        </ul>
        <Route path={`${path}/:id`} component={MessageDetail}></Route>
      </div>
    )
  }
}
```

è·¯ç”±é“¾æ¥ä¸éè·¯ç”±é“¾æ¥ï¼šæ˜¯å¦å‘äº†è¯·æ±‚ï¼ˆè·¯ç”±è¿æ¥ä¸å‘ï¼‰

- `<NavLink to=''></NavLink>`
- `<Link to=''></Link>`
- `<a href=''></a>`

### 6.6 å¤šç§è·¯ç”±è·³è½¬æ–¹å¼

å‰é¢è®²çš„è·¯ç”±åˆ‡æ¢éƒ½æ˜¯é€šè¿‡ç‚¹å‡»é“¾æ¥çš„æ–¹å¼åˆ‡æ¢çš„ï¼Œä¸æ˜¯é“¾æ¥ä¹Ÿèƒ½å¤Ÿ

![react-router demo4](https://cdn.wallleap.cn/img/pic/illustration/react-router-demo4.gif)

äºŒçº§è·¯ç”±ï¼š`views/message.jsx`

```jsx
import React from 'react'
import {Link, Route} from 'react-router-dom'
import MessageDetail from "./message-detail"

export default class Message extends React.Component {
  state = {
    messages: []
  }

  componentDidMount () {
    // æ¨¡æ‹Ÿå‘é€ajaxè¯·æ±‚
    setTimeout(() => {
      const data = [
        {id: 1, title: 'Message001'},
        {id: 3, title: 'Message003'},
        {id: 6, title: 'Message006'},
      ]
      this.setState({
        messages: data
      })
    }, 1000)
  }

  // propsä¸­æœ‰historyå±æ€§ï¼Œå®ƒç”±pushç­‰æ–¹æ³•
  ShowDetail = (id) => {
    this.props.history.push(`/home/message/${id}`)
  }

  ShowDetail2 = (id) => {
    this.props.history.replace(`/home/message/${id}`)
  }

  back = () => {
    this.props.history.goBack()
  }

  forward = () => {
    this.props.history.goForward()
  }

  render () {
    const path = this.props.match.path

    return (
      <div>
        <ul>
          {
            this.state.messages.map((m, index) => {
              return (
                <li key={index}>
                  <Link to={`${path}/${m.id}`}>{m.title}</Link>
                  &nbsp;&nbsp;&nbsp;
                  <button onClick={() => this.ShowDetail(m.id)}>æŸ¥çœ‹è¯¦æƒ…(push)</button>&nbsp;
                  <button onClick={() => this.ShowDetail2(m.id)}>æŸ¥çœ‹è¯¦æƒ…(replace)</button>
                </li>
              )
            })
          }
        </ul>
        <p>
          <button onClick={this.back}>è¿”å›</button>&nbsp;
          <button onClick={this.forward}>å‰è¿›</button>&nbsp;
        </p>
        <hr/>
        <Route path={`${path}/:id`} component={MessageDetail}></Route>
        {/*<Route path={`home/message/meassagedetail/:id`} component={MessageDetail}></Route>*/}
      </div>
    )
  }
}
```

æ€»ç»“ï¼š

- è·¯ç”±å™¨æ ‡ç­¾
  - `<BrowserRouter>`ï¼šBrowserRouter æ˜¯ react è·¯ç”±çš„å®¹å™¨
  - `<HashRouter>`ï¼šå¤šäº†ä¸€ä¸ª `#` å·

- è·¯ç”±
  - `<Route>`ï¼šRoute çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ¸²æŸ“è·¯ç”±åŒ¹é…çš„ç»„ä»¶ã€‚è·¯ç”±æ¸²æŸ“æœ‰ä¸‰ç§æ–¹å¼ï¼Œæ¯ä¸€ç§æ–¹å¼éƒ½å¯ä»¥ä¼ é€’ match,location,history å¯¹è±¡

- `<Redirect>`ï¼šè·¯ç”±é‡å®šå‘

- é“¾æ¥
  - `<Link>`ï¼šLinkçš„ä½œç”¨å’Œaæ ‡ç­¾ç±»ä¼¼
  - `<NavLink>`ï¼šå¯ä»¥æ·»åŠ å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚ activeClassName
- `<Switch>`ï¼šSwitch ç»„ä»¶å†…éƒ¨å¯ä»¥æ˜¯ Route æˆ–è€… Redirectï¼Œåªä¼šæ¸²æŸ“ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ 

- `this.props.`
  - `match`
    - `params`
  - `history`
    - `push()`
    - `replace()`
    - `goback()`
    - `goforward()`

## ä¸ƒã€react-ui

### 7.1 æœ€æµè¡Œçš„å¼€æº React UI ç»„ä»¶åº“

#### 7.1.1 material-uiï¼ˆå›½å¤–ï¼‰

- å®˜ç½‘ï¼š<http://www.material-ui.com/#/>

- GitHubï¼š<https://github.com/callemall/material-ui>

#### 7.1.2 ant-designï¼ˆå›½å†…èš‚èšé‡‘æœï¼‰

- PC å®˜ç½‘ï¼š<https://ant.design/index-cn>

- ç§»åŠ¨å®˜ç½‘ï¼š<https://mobile.ant.design/index-cn>

- Githubï¼š<https://github.com/ant-design/ant-design/>

- Githubï¼š<https://github.com/ant-design/ant-design-mobile/>

### 7.2 ant-design-mobile ä½¿ç”¨å…¥é—¨

![antd-mobile](https://cdn.wallleap.cn/img/pic/illustration/antd-mobile.gif)

ä½¿ç”¨ create-react-app åˆ›å»º react åº”ç”¨

```bash
npm install create-react-app -g
create-react-app antm-demo
cd antm-demo
npm start
```

æ­å»º antd-mobile çš„åŸºæœ¬å¼€å‘ç¯å¢ƒ

ä¸‹è½½ `npm install antd-mobile --save`

`src/components/App.jsx`

```jsx
import React, {Component} from 'react'
import {Button, Toast} from 'antd-mobile'
export default class App extends Component {
  handleClick = () => {
    Toast.info('æäº¤æˆåŠŸ', 2)
  }

  render() {
    return (
        <div>
          <Button type="primary" onClick={this.handleClick}>æäº¤</Button>
        </div>   
      )
  }
  /* typeå€¼ä¸åŒæ ·å¼ä¸åŒ */
}
```

`src/index.js`

```javascript
import React from 'react';
import {render} from 'react-dom'
import App from "./components/App"
// å¼•å…¥æ•´ä½“css
import 'antd-mobile/dist/antd-mobile.css'

render(<App />, document.getElementById('root'))
```

`index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>React ant design mobile</title>
    <script src="https://as.alipayobjects.com/g/component/fastclick/1.0.6/fastclick.js"></script>
    <script>
      if ('addEventListener' in document) {
        document.addEventListener('DOMContentLoaded', function() {
          FastClick.attach(document.body);
        }, false);
      }
      if(!window.Promise) {
        document.writeln('<script src="https://as.alipayobjects.com/g/component/es6-promise/3.2.2/es6-promise.min.js"'+'>'+'<'+'/'+'script>');
      }
    </script>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
  </body>
</html>
```

å®ç°æŒ‰éœ€æ‰“åŒ…(ç»„ä»¶ js/css)

ä¸‹è½½ä¾èµ–åŒ…

```bash
yarn add react-app-rewired --dev
yarn add babel-plugin-import --dev
```

ä¿®æ”¹é»˜è®¤é…ç½®ï¼š`package.json`

```json
{
  "name": "react_ui",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "antd-mobile": "^2.1.3",
    "react": "^16.2.0",
    "react-dom": "^16.2.0"
  },
  "devDependencies": {
    "babel-plugin-import": "^1.6.3",
    "react-app-rewired": "^1.4.0",
    "react-scripts": "1.0.17"
  },
  "scripts": {
    "start": "react-app-rewired start",
    "build": "react-app-rewired build",
    "test": "react-app-rewired test --env=jsdom"
  }
}
```

`config-overrides.js`

```javascript
const {injectBabelPlugin} = require('react-app-rewired');
module.exports = function override(config, env) {
  config = injectBabelPlugin(['import', {libraryName: 'antd-mobile', style: 'css'}], config);
  return config;
};
```

ç¼–ç 

```jsx
// import 'antd-mobile/dist/antd-mobile.css'
// import Button from 'antd-mobile/lib/button'
// import Toast from 'antd-mobile/lib/toast' 
import {Button, Toast} from 'antd-mobile'
```

## å…«ã€redux

### 8.1 redux ç†è§£

å­¦ä¹ æ–‡æ¡£

- è‹±æ–‡æ–‡æ¡£: <https://redux.js.org/>

- ä¸­æ–‡æ–‡æ¡£: <http://www.redux.org.cn/>

- Github: <https://github.com/reactjs/redux>

redux æ˜¯ä»€ä¹ˆ?

- redux æ˜¯ä¸€ä¸ªç‹¬ç«‹ä¸“é—¨ç”¨äºåš**çŠ¶æ€ç®¡ç†**çš„ **JS åº“**ï¼ˆä¸æ˜¯ react æ’ä»¶åº“ï¼‰

- å®ƒå¯ä»¥ç”¨åœ¨ reactã€angularã€vue ç­‰é¡¹ç›®ä¸­ï¼Œä½†åŸºæœ¬ä¸ react é…åˆä½¿ç”¨

- ä½œç”¨ï¼š**é›†ä¸­å¼ç®¡ç†** react åº”ç”¨ä¸­å¤šä¸ªç»„ä»¶å…±äº«çš„çŠ¶æ€

redux å·¥ä½œæµç¨‹

![redux](https://cdn.wallleap.cn/img/pic/illustration/image-20200715104120743.png)

ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ redux

- æ€»ä½“åŸåˆ™ï¼šèƒ½ä¸ç”¨å°±ä¸ç”¨, å¦‚æœä¸ç”¨æ¯”è¾ƒåƒåŠ›æ‰è€ƒè™‘ä½¿ç”¨

- æŸä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œéœ€è¦å…±äº«

- æŸä¸ªçŠ¶æ€éœ€è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ‹¿åˆ°

- ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å…¨å±€çŠ¶æ€

- ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€

### 8.2 redux çš„æ ¸å¿ƒ API

#### 8.2.1 `createStore()`

ä½œç”¨ï¼šåˆ›å»ºåŒ…å«æŒ‡å®š reducer çš„ store å¯¹è±¡

ç¼–ç :

```js
import {createStore} from 'redux'
import counter from './reducers/counter'
const store = createStore(counter)
```

#### 8.2.2 `store`å¯¹è±¡

ä½œç”¨ï¼šredux åº“æœ€æ ¸å¿ƒçš„ç®¡ç†å¯¹è±¡

å®ƒå†…éƒ¨ç»´æŠ¤ç€ï¼š

- `state`

- `reducer`

æ ¸å¿ƒæ–¹æ³•ï¼š

- `getState()`

- `dispatch(action)`

- `subscribe(listener)`

ç¼–ç :

```js
store.getState()
store.dispatch({type:'INCREMENT', number})
store.subscribe(render)
```

#### 8.2.3 `applyMiddleware()`

ä½œç”¨ï¼šåº”ç”¨ä¸ŠåŸºäº redux çš„ä¸­é—´ä»¶ï¼ˆæ’ä»¶åº“ï¼‰

ç¼–ç ï¼š

```js
import {createStore, applyMiddleware} from 'redux'
import thunk from 'redux-thunk' // reduxå¼‚æ­¥ä¸­é—´ä»¶
const store = createStore(
counter,
applyMiddleware(thunk) // åº”ç”¨ä¸Šå¼‚æ­¥ä¸­é—´ä»¶
)
```

#### 8.2.4 `combineReducers()`

ä½œç”¨ï¼šåˆå¹¶å¤šä¸ª reducer å‡½æ•°

ç¼–ç ï¼š

```js
export default combineReducers({
  user,
  chatUser,
  chat
})
```

### 8.3 reduxçš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ

#### 8.3.1 `action`

æ ‡è¯†è¦æ‰§è¡Œè¡Œä¸ºçš„å¯¹è±¡

åŒ…å« 2 ä¸ªæ–¹é¢çš„å±æ€§

- typeï¼šæ ‡è¯†å±æ€§ï¼Œå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œå”¯ä¸€ï¼Œå¿…è¦å±æ€§

- xxxï¼šæ•°æ®å±æ€§ï¼Œå€¼ç±»å‹ä»»æ„ï¼Œå¯é€‰å±æ€§

ä¾‹å­ï¼š

```js
const action = {
  type: 'INCREMENT',
  data: 2
}
```

- Action Creatorï¼ˆåˆ›å»º Action çš„å·¥å‚å‡½æ•°ï¼‰

```js
const increment = (number) => ({type: 'INCREMENT', data: number})
```

#### 8.3.2 `reducer`

æ ¹æ®è€çš„ state å’Œ actionï¼Œäº§ç”Ÿæ–°çš„ state çš„çº¯å‡½æ•°

æ ·ä¾‹

```js
export default function counter(state = 0, action) {
  switch (action.type) {
    case 'INCREMENT':
      return state + action.data
    case 'DECREMENT':
      return state - action.data
    default:
      return state
  }
}
```

æ³¨æ„

- è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€

- ä¸è¦ä¿®æ”¹åŸæ¥çš„çŠ¶æ€

#### 8.3.3 `store`

å°† stateã€action ä¸ reducer è”ç³»åœ¨ä¸€èµ·çš„å¯¹è±¡

å¦‚ä½•å¾—åˆ°æ­¤å¯¹è±¡?

```js
import {createStore} from 'redux'
import reducer from './reducers'
const store = createStore(reducer)
```

æ­¤å¯¹è±¡çš„åŠŸèƒ½?

- getState()ï¼šå¾—åˆ° state

- dispatch(action)ï¼šåˆ†å‘ actionï¼Œè§¦å‘ reducer è°ƒç”¨ï¼Œäº§ç”Ÿæ–°çš„ state

- subscribe(listener)ï¼šæ³¨å†Œç›‘å¬ï¼Œå½“äº§ç”Ÿäº†æ–°çš„ state æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨

### 8.4 ä½¿ç”¨ redux ç¼–å†™åº”ç”¨

æ•ˆæœ

![redux](https://cdn.wallleap.cn/img/pic/illustration/redux.gif)

ä½¿ç”¨ react å®ç°

![app.jsx](https://cdn.wallleap.cn/img/pic/illustration/image-20200715112226383.png)

![index.js](https://cdn.wallleap.cn/img/pic/illustration/image-20200715112313127.png)

ä¸‹è½½ä¾èµ–åŒ…

```sh
npm install --save redux
```

`src/redux/action-types.js`

```javascript
/*
Actionå¯¹è±¡çš„typeå¸¸é‡åç§°æ¨¡å—
*/
export const INCREMENT = 'increment'
export const DECREMENT = 'decrement'
```

`src/redux/actions.js`

```javascript
/*
action creatoræ¨¡å—
*/
import {INCREMENT, DECREMENT} from './action-types'

export const increment = number => ({type: INCREMENT, number})
export const decrement = number => ({type: DECREMENT, number})
```

`src/redux/reducers.js`

```javascript
/*
åŒ…å«nä¸ªreducerå‡½æ•°çš„æ¨¡å—
æ ¹æ®è€çš„stateå’ŒæŒ‡å®šaction, å¤„ç†è¿”å›ä¸€ä¸ªæ–°çš„state
*/
import {INCREMENT, DECREMENT} from './action-types'

export function counter(state = 0, action) {
  console.log('counter', state, action)
  switch (action.type) {
    case INCREMENT:
      return state + action.number
    case DECREMENT:
      return state - action.number
    default:
      return state
  }
}
```

`src/components/app.jsx`

```jsx
/*
åº”ç”¨ç»„ä»¶
*/
import React, {Component} from 'react'
import PropTypes from 'prop-types'
import * as actions from '../redux/actions'
import { INCREMENT } from '../redux/action-types'

export default class App extends Component {
  static propTypes = {
    store: PropTypes.object.isRequired,
  }

  increment = () => {
    // 1.å¾—åˆ°é€‰æ‹©å¢åŠ æ•°é‡
    const number = this.refs.numSelect.value * 1
    // 2.è°ƒç”¨storeçš„æ–¹æ³•æ›´æ–°çŠ¶æ€
    this.props.store.dispatch(actions.increment(number))
  }

  decrement = () => {
    // 1.å¾—åˆ°é€‰æ‹©å‡å°æ•°é‡
    const number = this.refs.numSelect.value * 1
    // 2.è°ƒç”¨storeçš„æ–¹æ³•æ›´æ–°çŠ¶æ€
    this.props.store.dispatch(actions.decrement(number))
  }

  incrementIfOdd = () => {
    // 1.å¾—åˆ°é€‰æ‹©å¢åŠ æ•°é‡
    const number = this.refs.numSelect.value * 1
    // 2.å¾—åˆ°åŸæœ¬çš„countçŠ¶æ€
    let count = this.props.store.getState()
    // åˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶çŒœæ›´æ–°çŠ¶æ€
    if (count % 2 === 1) {
      // è°ƒç”¨storeçš„æ–¹æ³•æ›´æ–°çŠ¶æ€
      this.props.store.dispatch(actions.increment(number))
    }
  }

  incrementAsync = () => {
    // 1.å¾—åˆ°é€‰æ‹©å¢åŠ æ•°é‡
    const number = this.refs.numSelect.value * 1
    // 2.å¯åŠ¨å»¶æ—¶å®šæ—¶å™¨ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥
    setTimeout(() => {
      // 3.è°ƒç”¨storeçš„æ–¹æ³•æ›´æ–°çŠ¶æ€
      this.props.store.dispatch(actions.increment(number))
    }, 1000)
  }

  render() {
    const count = this.props.store.getState()
    return (
      <div>
        <p>
          click {count} times {' '}
        </p>
        <select ref="numSelect">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>{' '}
        <button onClick={this.increment}>+</button>
        {' '}
        <button onClick={this.decrement}>-</button>
        {' '}
        <button onClick={this.incrementIfOdd}>increment if odd</button>
        {' '}
        <button onClick={this.incrementAsync}>increment async</button>
      </div>
    )
  }
}
```

`src/index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import {createStore} from 'redux'

import App from './components/app'
import {counter} from './redux/reducers'

// æ ¹æ®counterå‡½æ•°åˆ›å»ºstoreå¯¹è±¡
const store = createStore(counter) // å†…éƒ¨ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨reduerå‡½æ•°ï¼Œå¾—åˆ°åˆå§‹state

// å®šä¹‰æ¸²æŸ“æ ¹ç»„ä»¶æ ‡ç­¾çš„å‡½æ•°
const render = () => {
  ReactDOM.render(
    <App store={store}/>,
    document.getElementById('root')
  )
}
// åˆå§‹åŒ–æ¸²æŸ“
render()

// æ³¨å†Œ(è®¢é˜…)ç›‘å¬, ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜, è‡ªåŠ¨é‡æ–°æ¸²æŸ“
store.subscribe(render)
```

ä¹Ÿå¯ä»¥æŠŠ `index.js` ä¸­ `store` æå–å‡ºæ¥

`src/redux/store.js`

```javascript
import {createStore} from 'redux'
import {counter} from './reducers'
// æ ¹æ®counterå‡½æ•°åˆ›å»ºstoreå¯¹è±¡
const store = createStore(counter)  // // å†…éƒ¨ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨reduerå‡½æ•°ï¼Œå¾—åˆ°åˆå§‹state

export default store
```

`src/index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'

import App from './components/app'
import store from './redux/store'

// å®šä¹‰æ¸²æŸ“æ ¹ç»„ä»¶æ ‡ç­¾çš„å‡½æ•°
const render = () => {
  ReactDOM.render(
    <App store={store}/>,
    document.getElementById('root')
  )
}
// åˆå§‹åŒ–æ¸²æŸ“
render()

// æ³¨å†Œ(è®¢é˜…)ç›‘å¬, ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜, è‡ªåŠ¨é‡æ–°æ¸²æŸ“
store.subscribe(render)
```

é—®é¢˜

- redux ä¸ react ç»„ä»¶çš„ä»£ç è€¦åˆåº¦å¤ªé«˜ï¼ˆå¤§å¤šæ•°åœ°æ–¹ç”¨åˆ° storeï¼‰

- ç¼–ç ä¸å¤Ÿç®€æ´

### 8.5 react-redux

#### 8.5.1 ç†è§£

- ä¸€ä¸ª **react æ’ä»¶åº“**

- ä¸“é—¨ç”¨æ¥ç®€åŒ– react åº”ç”¨ä¸­ä½¿ç”¨ redux

#### 8.5.2 React-Redux å°†æ‰€æœ‰ç»„ä»¶åˆ†æˆä¸¤å¤§ç±»

- UI ç»„ä»¶

  - åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘

  - é€šè¿‡ props æ¥æ”¶æ•°æ®ï¼ˆä¸€èˆ¬æ•°æ®å’Œå‡½æ•°ï¼‰

  - ä¸ä½¿ç”¨ä»»ä½• Redux çš„ API

  - ä¸€èˆ¬ä¿å­˜åœ¨ `components` æ–‡ä»¶å¤¹ä¸‹

- å®¹å™¨ç»„ä»¶

  - è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°

  - ä½¿ç”¨ Redux çš„ API

  - ä¸€èˆ¬ä¿å­˜åœ¨ `containers` æ–‡ä»¶å¤¹ä¸‹

#### 8.5.3 ç›¸å…³API

`Provider`

è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥å¾—åˆ°stateæ•°æ®

```js
<Provider store={store}>
   <App />
</Provider>
```

`connect()`

ç”¨äºåŒ…è£… UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶

```js
import { connect } from 'react-redux'
connect(
   mapStateToprops,
   mapDispatchToProps
)(Counter)
```

`mapStateToprops()`

å°†å¤–éƒ¨çš„æ•°æ®ï¼ˆå³ state å¯¹è±¡ï¼‰è½¬æ¢ä¸º UI ç»„ä»¶çš„æ ‡ç­¾å±æ€§

```js
const mapStateToprops = function (state) {
  return {
   value: state
  }
}
```

`mapDispatchToProps()`

å°†åˆ†å‘ action çš„å‡½æ•°è½¬æ¢ä¸º UI ç»„ä»¶çš„æ ‡ç­¾å±æ€§

ç®€æ´è¯­æ³•å¯ä»¥ç›´æ¥æŒ‡å®šä¸º actions å¯¹è±¡æˆ–åŒ…å«å¤šä¸ª action æ–¹æ³•çš„å¯¹è±¡

#### 8.5.4 ä½¿ç”¨ react-redux

ä¸‹è½½ä¾èµ–åŒ…

```sh
npm install --save react-redux
```

`redux/action-types.js`

ä¸å˜

`redux/actions.js`

ä¸å˜

`redux/reducers.js`

ä¸å˜

`components/counter.jsx`

```jsx
/*
UIç»„ä»¶: ä¸åŒ…å«ä»»ä½•redux API
*/
import React from 'react'
import PropTypes from 'prop-types'

export default class Counter extends React.Component {

  static propTypes = {
    count: PropTypes.number.isRequired,
    increment: PropTypes.func.isRequired,
    decrement: PropTypes.func.isRequired
  }

  increment = () => {
    const number = this.refs.numSelect.value * 1
    this.props.increment(number)
  }

  decrement = () => {
    const number = this.refs.numSelect.value * 1
    this.props.decrement(number)
  }

  incrementIfOdd = () => {
    const number = this.refs.numSelect.value * 1
    let count = this.props.count
    if (count % 2 === 1) {
      this.props.increment(number)
    }
  }

  incrementAsync = () => {
    const number = this.refs.numSelect.value * 1
    setTimeout(() => {
      this.props.increment(number)
    }, 1000)
  }

  render() {
    return (
      <div>
        <p>
          click {this.props.count} times {' '}
        </p>
        <select ref="numSelect">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>{' '}
        <button onClick={this.increment}>+</button>
        {' '}
        <button onClick={this.decrement}>-</button>
        {' '}
        <button onClick={this.incrementIfOdd}>increment if odd</button>
        {' '}
        <button onClick={this.incrementAsync}>increment async</button>
      </div>
    )
  }
}
```

`containers/app.jsx`

```jsx
/*
åŒ…å«Counterç»„ä»¶çš„å®¹å™¨ç»„ä»¶
*/
import React from 'react'
// å¼•å…¥è¿æ¥å‡½æ•°
import {connect} from 'react-redux'
// å¼•å…¥actionå‡½æ•°
import {increment, decrement} from '../redux/actions'

import Counter from '../components/counter'

// å‘å¤–æš´éœ²è¿æ¥Appç»„ä»¶çš„åŒ…è£…ç»„ä»¶
export default connect(
  state => ({count: state}),
  {increment, decrement}
)(Counter)
```

`store.js`

ä¸å˜

`index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import {Provider} from 'react-redux'

import App from './containers/app'
import store from './redux/store'

// å®šä¹‰æ¸²æŸ“æ ¹ç»„ä»¶æ ‡ç­¾çš„å‡½æ•°
ReactDOM.render(
  (
    <Provider store={store}>
      <App/>
    </Provider>
  ),
  document.getElementById('root')
)
```

é—®é¢˜

- redux é»˜è®¤æ˜¯ä¸èƒ½è¿›è¡Œå¼‚æ­¥å¤„ç†çš„ï¼ˆå‰é¢çš„éƒ½æ˜¯ react å®ç°çš„ï¼‰

- åº”ç”¨ä¸­åˆéœ€è¦åœ¨ redux ä¸­æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼ˆajaxã€å®šæ—¶å™¨ç­‰ï¼‰

### 8.6 redux å¼‚æ­¥ç¼–ç¨‹

ä¸‹è½½ redux æ’ä»¶ï¼ˆå¼‚æ­¥ä¸­é—´ä»¶ï¼‰

```sh
npm install --save redux-thunk
```

`redux/store.js`

```javascript
import React from 'react'
import {createStore, applyMiddleware} from 'redux'
import thunk from 'redux-thunk'
import {composeWithDevTools} from 'redux-devtools-extension'

import reducers from './reducers'

// æ ¹æ®counterå‡½æ•°åˆ›å»ºstoreå¯¹è±¡
export default createStore(
  reducers,
  applyMiddleware(thunk) // åº”ç”¨ä¸Šå¼‚æ­¥ä¸­é—´ä»¶
)
```

`index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import {Provider} from 'react-redux'

import App from './containers/app'
import store from './redux/store'

// å®šä¹‰æ¸²æŸ“æ ¹ç»„ä»¶æ ‡ç­¾çš„å‡½æ•°
ReactDOM.render(
  (
    <Provider store={store}>
      <App/>
    </Provider>
  ),
  document.getElementById('root')
)
```

`redux/actions.js`

```jsx
/*
action creatoræ¨¡å—
*/
import {
  INCREMENT,
  DECREMENT
} from './action-types'

export const increment = number => ({type: INCREMENT, number})

export const decrement = number => ({type: DECREMENT, number})

// å¼‚æ­¥action creator(è¿”å›ä¸€ä¸ªå‡½æ•°)
export const incrementAsync = number => {
  return dispatch => { // è¦åœ¨è¿™è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åœ¨storeä¸­åº”ç”¨ä¸Šå¼‚æ­¥ä¸­é—´ä»¶
    // å¼‚æ­¥çš„ä»£ç 
    setTimeout(() => {
      // 1sä¹‹åæ‰åˆ†å‘ä¸€ä¸ªå¢åŠ çš„action
      dispatch(increment(number))
    }, 1000)
  }
}
```

åŒæ­¥çš„ action éƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡

å¼‚æ­¥çš„ action è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°

`components/counter.jsx`

```jsx
/*
åŒ…å«Counterç»„ä»¶çš„å®¹å™¨ç»„ä»¶
*/
import React from 'react'
import PropTypes from 'prop-types'

export default class Counter extends React.Component {

  static propTypes = {
    count: PropTypes.number.isRequired,
    increment: PropTypes.func.isRequired,
    decrement: PropTypes.func.isRequired
  }

  increment = () => {
    const number = this.refs.numSelect.value*1
    this.props.increment(number)
  }

  decrement = () => {
    const number = this.refs.numSelect.value*1
    this.props.decrement(number)
  }

  incrementIfOdd = () => {
    const number = this.refs.numSelect.value*1
    let count = this.props.count
    if(count%2===1) {
      this.props.increment(number)
    }
  }

  // Async
  incrementAsync = () => {
    const number = this.refs.numSelect.value*1
    this.props.incrementAsync(number)
  }

  render () {
    return (
      <div>
        <p>
          click {this.props.count} times {' '}
        </p>
        <select ref="numSelect">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>{' '}
        <button onClick={this.increment}>+</button>{' '}
        <button onClick={this.decrement}>-</button>{' '}
        <button onClick={this.incrementIfOdd}>increment if odd</button>{' '}
        <button onClick={this.incrementAsync}>increment async</button>
      </div>
    )
  }
}
```

`containers/app.jsx`

```jsx
/*
åŒ…å«Counterç»„ä»¶çš„å®¹å™¨ç»„ä»¶
*/
import React from 'react'
// å¼•å…¥è¿æ¥å‡½æ•°
import {connect} from 'react-redux'
// å¼•å…¥actionå‡½æ•°
import {increment, decrement, incrementAsync} from '../redux/actions'
import Counter from '../components/counter'

// å‘å¤–æš´éœ²è¿æ¥Appç»„ä»¶çš„åŒ…è£…ç»„ä»¶
export default connect(
  state => ({count: state.counter}),
  {increment, decrement, incrementAsync}
)(Counter)
```

`redux/action-types.js`

```javascript
export const INCREMENT = 'increment'
export const DECREMENT = 'decrement'
```

### 8.7 ä½¿ç”¨ä¸Š redux è°ƒè¯•å·¥å…·

å®‰è£… Chrome æµè§ˆå™¨æ’ä»¶

[Redux DevTools](https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?utm_source=chrome-ntp-icon)

ä¸‹è½½å·¥å…·ä¾èµ–åŒ…

```sh
npm install --save-dev redux-devtools-extension
```

ç¼–ç 

```javascript
import { composeWithDevTools } from 'redux-devtools-extension'
const store = createStore(counter, composeWithDevTools(applyMiddleware(thunk)))
```

### 8.8 Redux ç‰ˆè¯„è®º

éœ€æ±‚

ä½¿ç”¨ react_redux å’Œä¸­é—´ä»¶å®ç°å¼‚æ­¥è¯„è®ºåŠŸèƒ½

å®‰è£…

```bash
â€¦â€¦
npm install --save react-redux
npm install --save redux-thunk
npm install --save-dev redux-devtools-extension
```

ç›®å½•ç»“æ„

```md
> - REACT_REDUX
>   - public
>     - css
>       - bootstrap.css
>     - index.html
>   - src
>     - components
>       - app
>         - app.jsx
>       - comment-add
>         - comment-add.jsx
>       - comment-item
>         - comment-item.jsx
>         - comment-item.css
>       - comment-list
>         - comment-list.jsx
>         - comment-list.css
>     - redux
>       - action-types.js
>       - actions.js
>       - reducers.js
>       - store.js
>     - index.js
```

æ–‡ä»¶å†…å®¹

`public/index.html`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>React App</title>
    <link rel="stylesheet" href="/css/bootstrap.css">
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
  </body>
</html>
```

`src/index.js`

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import {Provider} from 'react-redux'

import App from './components/app/app'
import store from './redux/store'

// å®šä¹‰æ¸²æŸ“æ ¹ç»„ä»¶æ ‡ç­¾çš„å‡½æ•°
ReactDOM.render(
  (
    <Provider store={store}>
      <App/>
    </Provider>
  ),
  document.getElementById('root')
)
```

`src/components/app/app.jsx`

```jsx
import React from 'react'
import {connect} from 'react-redux'
import CommentAdd from '../comment-add/comment-add'
import CommentList from '../comment-list/comment-list'
import {getComments} from '../../redux/actions'

class App extends React.Component {

  componentDidMount() {
    //æ¨¡æ‹Ÿå¼‚æ­¥è·å–æ•°æ®
    this.props.getComments()
  }

  render() {
    return (
      <div>
        <header className="site-header jumbotron">
          <div className="container">
            <div className="row">
              <div className="col-xs-12">
                <h1>è¯·å‘è¡¨å¯¹Reactçš„è¯„è®º</h1>
              </div>
            </div>
          </div>
        </header>
        <div className="container">
          <CommentAdd/>
          <CommentList/>
        </div>
      </div>
    )
  }
}

export default connect(
  null,
  {getComments}
)(App)
```

`src/components/comment-add/comment-add.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'
import {connect} from 'react-redux'
import {addComment} from '../../redux/actions'
class CommentAdd extends React.Component {
  constructor (props) {
    super(props)
    this.state = {
      username: '',
      content: ''
    }
    this.addComment = this.addComment.bind(this)
    this.changeUsername = this.changeUsername.bind(this)
    this.changeContent = this.changeContent.bind(this)
  }
  addComment () {
    // æ ¹æ®è¾“å…¥çš„æ•°æ®åˆ›å»ºè¯„è®ºå¯¹è±¡
    let { username, content } = this.state
    let comment = { username, content }
    // æ·»åŠ åˆ°commentsä¸­, æ›´æ–°state
    this.props.addComment(comment)
    // æ¸…é™¤è¾“å…¥çš„æ•°æ®
    this.setState({
      username: '',
      content: ''
    })
  }
  changeUsername (event) {
    this.setState({
      username: event.target.value
    })
  }
  changeContent (event) {
    this.setState({
      content: event.target.value
    })
  }
  render () {
    return (
      <div className="col-md-4">
        <form className="form-horizontal">
          <div className="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" className="form-control" placeholder="ç”¨æˆ·å"
                  value={this.state.username} onChange={this.changeUsername}/>
          </div>
          <div className="form-group">
            <label>è¯„è®ºå†…å®¹</label>
            <textarea
             className="form-control" rows="6" placeholder="è¯„è®ºå†…å®¹"
              value={this.state.content} onChange={this.changeContent}></textarea>
          </div>
          <div className="form-group">
            <div className="col-sm-offset-2 col-sm-10">
              <button type="button" className="btn btn-default pull-right" onClick={this.addComment}>æäº¤</button>
            </div>
          </div>
        </form>
      </div>
    )
  }
}
CommentAdd.propTypes = {
  addComment: PropTypes.func.isRequired
}
export default connect(
  null,
  {addComment}
)(CommentAdd)
```

`src/components/comment-item/comment-item.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'
import {connect} from 'react-redux'
import './commentItem.css'
import {deleteComment} from '../../redux/actions'
class CommentItem extends React.Component {
  constructor(props) {
    super(props)
  }
  deleteComment = () => {
    let username = this.props.comment.username
    if (window.confirm(`ç¡®å®šåˆ é™¤${username}çš„è¯„è®ºå—?`)) {
      this.props.deleteComment(this.props.index)
    }
  }
  render() {
    let comment = this.props.comment
    return (
      <li className="list-group-item">
        <div className="handle">
          <a href="javascript:" onClick={this.deleteComment}>åˆ é™¤</a>
        </div>
        <p className="user"><span>{comment.username}</span><span>è¯´:</span></p>
        <p className="centence">{comment.content}</p>
      </li>
    )
  }
}
CommentItem.propTypes = {
  comment: PropTypes.object.isRequired,
  index: PropTypes.number.isRequired,
  deleteComment: PropTypes.func.isRequired
}
export default connect(
  null,
  {deleteComment}
)(CommentItem)

```

`src/components/comment-item/comment-item.css`

```css
li {
  transition: .5s;
  overflow: hidden;
}
.handle {
  width: 40px;
  border: 1px solid #ccc;
  background: #fff;
  position: absolute;
  right: 10px;
  top: 1px;
  text-align: center;
}
.handle a {
  display: block;
  text-decoration: none;
}
.list-group-item .centence {
  padding: 0px 50px;
}
.user {
  font-size: 22px;
}
```

`src/components/comment-list/comment-list.jsx`

```jsx
import React from 'react'
import PropTypes from 'prop-types'
import {connect} from 'react-redux'
import CommentItem from '../comment-item/comment-item'
import './commentList.css'
class CommentList extends React.Component {
  render () {
    let comments = this.props.comments
    let display = comments.length > 0 ? 'none' : 'block'
    return (
      <div className="col-md-8">
        <h3 className="reply">è¯„è®ºå›å¤ï¼š</h3>
        <h2 style=åŒå¤§æ‹¬å· display: display åŒå¤§æ‹¬å·>æš‚æ— è¯„è®ºï¼Œç‚¹å‡»å·¦ä¾§æ·»åŠ è¯„è®ºï¼ï¼ï¼</h2>
        <ul className="list-group">
          {
            comments.map((comment, index) => {
              console.log(comment)
              return <CommentItem comment={comment} key={index} index={index}/>
            })
          }
        </ul>
      </div>
    )
  }
}
CommentList.propTypes = {
  comments: PropTypes.array.isRequired,
}
export default connect(
  state => ({comments: state.comments})
)(CommentList)
```

`src/components/comment-list/comment-list.css`

```css
.reply {
  margin-top: 0px;
}
```

`redux/action-types.js`

```javascript
export const ADD_COMMENT = 'ADD_COMMENT'
export const DELETE_COMMENT = 'DELETE_COMMENT'
export const RECEIVE_COMMENTS = 'RECEIVE_COMMENTS'
```

`redux/actions.js`

```javascript
import {
  ADD_COMMENT,
  DELETE_COMMENT,
  RECEIVE_COMMENTS
} from './action-types'
export const addComment = (comment) => ({type: ADD_COMMENT, data: comment})
export const deleteComment = (index) => ({type: DELETE_COMMENT, data: index})
const receiveComments = (comments) => ({type: RECEIVE_COMMENTS, data: comments})
export const getComments = () => {
  return dispatch => {
    setTimeout(() => {
      const comments = [
        {
          username: "Tom",
          content: "ReactJSå¥½éš¾å•Š!",
          id: Date.now()
        },
        {
          username: "JACK",
          content: "ReactJSè¿˜ä¸é”™!",
          id: Date.now() + 1
        }
      ]
      dispatch(receiveComments(comments))
    }, 1000)
  }
}
```

`redux/reducers.js`

```javascript
import {combineReducers} from 'redux'
import {
  ADD_COMMENT,
  DELETE_COMMENT,
  RECEIVE_COMMENTS
} from './action-types'
const initComments = []
function comments(state = initComments, action) {
  switch (action.type) {
    case ADD_COMMENT:
      return [...state, action.data]
    case DELETE_COMMENT:
      return state.filter((c, index) => index !== action.data)
    case RECEIVE_COMMENTS:
      return action.data
    default:
      return state
  }
}
export default combineReducers({
  comments
})
```

`redux/store.js`

```javascript
import React from 'react'
import {createStore, applyMiddleware} from 'redux'
import thunk from 'redux-thunk'
import {composeWithDevTools} from 'redux-devtools-extension'
import reducers from './reducers'
// æ ¹æ®counterå‡½æ•°åˆ›å»ºstoreå¯¹è±¡
export default createStore(
  reducers,
  composeWithDevTools(applyMiddleware(thunk)) // åº”ç”¨ä¸Šå¼‚æ­¥ä¸­é—´ä»¶
)
```

### 8.9 ç›¸å…³é‡è¦çŸ¥è¯†ï¼šçº¯å‡½æ•°å’Œé«˜é˜¶å‡½æ•°

#### 8.9.1 çº¯å‡½æ•°

- ä¸€ç±»ç‰¹åˆ«çš„å‡½æ•°ï¼šåªè¦æ˜¯åŒæ ·çš„è¾“å…¥ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡º

  - å¿…é¡»éµå®ˆä»¥ä¸‹ä¸€äº›çº¦æŸ

    - ä¸å¾—æ”¹å†™å‚æ•°

    - ä¸èƒ½è°ƒç”¨ç³»ç»Ÿ I/O çš„ API

    - èƒ½è°ƒç”¨ `Date.now()` æˆ–è€… `Math.random()` ç­‰ä¸çº¯çš„æ–¹æ³•

- reducerå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°

#### 8.9.2 é«˜é˜¶å‡½æ•°

- ç†è§£ï¼šä¸€ç±»ç‰¹åˆ«çš„å‡½æ•°

  - æƒ…å†µ 1ï¼šå‚æ•°æ˜¯å‡½æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰

  - æƒ…å†µ 2ï¼šè¿”å›æ˜¯å‡½æ•°ï¼ˆæ–°çš„å‡½æ•°ï¼‰

- å¸¸è§çš„é«˜é˜¶å‡½æ•°ï¼š

  - å®šæ—¶å™¨è®¾ç½®å‡½æ•°ï¼šsetTimeout()/setInterval()

  - æ•°ç»„çš„ map()/filter()/reduce()/find()/bind()

  - react-redux ä¸­çš„ connect å‡½æ•°

- ä½œç”¨ï¼šèƒ½å®ç°æ›´åŠ åŠ¨æ€ï¼Œæ›´åŠ å¯æ‰©å±•çš„åŠŸèƒ½
